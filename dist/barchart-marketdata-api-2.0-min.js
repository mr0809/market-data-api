!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Barchart||(t.Barchart={})).Streaming=e()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";t.exports=function(){var e={keys:function t(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}};return e}()},{}],2:[function(e,t,r){"use strict";var n=e("./websocket/Connection");t.exports=function(){return n}()},{"./websocket/Connection":11}],3:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../marketState/MarketState");t.exports=function(){var e=function(){function e(){n(this,e),this._server=null,this._username=null,this._password=null,this._marketState=new a,this._pollingFrequency=null}return i(e,[{key:"connect",value:function(e,t,r){this._server=e,this._username=t,this._password=r,this._connect()}},{key:"_connect",value:function(){}},{key:"disconnect",value:function(){this._server=null,this._username=null,this._password=null,this._disconnect()}},{key:"_disconnect",value:function(){}},{key:"on",value:function(){this._on.apply(this,arguments)}},{key:"_on",value:function(){}},{key:"off",value:function(){this._off.apply(this,arguments)}},{key:"_off",value:function(){}},{key:"getActiveSymbolCount",value:function(){return this._getActiveSymbolCount()}},{key:"_getActiveSymbolCount",value:function(){return null}},{key:"getPollingFrequency",value:function(){return this._pollingFrequency}},{key:"setPollingFrequency",value:function(e){this._pollingFrequency!==e&&(e&&e>0?this._pollingFrequency=e:this._pollingFrequency=null,this._onPollingFrequencyChanged(this._pollingFrequency))}},{key:"_onPollingFrequencyChanged",value:function(e){}},{key:"getMarketState",value:function(){return this._marketState}},{key:"getServer",value:function(){return this._server}},{key:"getPassword",value:function(){return this._password}},{key:"getUsername",value:function(){return this._username}},{key:"toString",value:function(){return"[ConnectionBase]"}}]),e}();return e}()},{"./../marketState/MarketState":15}],4:[function(e,t,r){"use strict";var n=e("./http/HistoricalDataProvider");t.exports=function(){return n}()},{"./http/HistoricalDataProvider":8}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(){var e=function(){function e(){n(this,e)}return i(e,[{key:"getHistoricalData",value:function(e,t){var r=this;return Promise.resolve().then(function(){return r._getHistoricalData(e,t)})}},{key:"_getHistoricalData",value:function(e,t){return[]}},{key:"toString",value:function(){return"[HistoricalDataProviderBase]"}}]),e}();return e}()},{}],6:[function(e,t,r){"use strict";var n=e("./http/ProfileProvider");t.exports=function(){return n}()},{"./http/ProfileProvider":9}],7:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(){var e=function(){function e(){n(this,e)}return i(e,[{key:"loadProfileData",value:function(e,t){var r=this;return Promise.resolve().then(function(){return r._loadProfileData(e,t)})}},{key:"_loadProfileData",value:function(e,t){return[]}},{key:"toString",value:function(){return"[ProfileProviderBase]"}}]),e}();return e}()},{}],8:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("xhr"),u=e("./../../../common/lang/object"),c=e("./../../HistoricalDataProviderBase");t.exports=function(){var e=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),o(t,[{key:"_getHistoricalData",value:function(e,t){return new Promise(function(r){var n=u.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[p])}),i={url:encodeURI("proxies/historicaldata/?"+n.join("&")),method:"GET",json:!0};s(i,function(e,n,i){var a=void 0;a=e||200!==n.statusCode?[]:i,"function"==typeof t&&t(a),r(a)})})}},{key:"toString",value:function(){return"[HistoricalDataProvider]"}}]),t}(c);return e}()},{"./../../../common/lang/object":1,"./../../HistoricalDataProviderBase":5,xhr:52}],9:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("xhr"),u=e("./../../ProfileProviderBase");t.exports=function(){var e=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),o(t,[{key:"_loadProfileData",value:function(e,t){return new Promise(function(r){var n={url:"proxies/instruments/?lookup="+e.join(","),method:"GET",json:!0};s(n,function(e,n,i){var a=void 0;a=e||200!==n.statusCode?[]:i.instruments,"function"==typeof t&&t(a),r(a)})})}},{key:"toString",value:function(){return"[ProfileProvider]"}}]),t}(u);return e}()},{"./../../ProfileProviderBase":7,xhr:52}],10:[function(e,t,r){"use strict";var n=e("./Connection");t.exports=function(){return n}()},{"./Connection":2}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("barchart-marketdata-utilities"),u=e("./../../../common/lang/object"),c=e("./../../ConnectionBase"),l=e("./../../../messageParser/parseMessage");t.exports=function(){function e(e){function n(e,t){var r=R.length-1;r>0&&R[r].id===e?R[r].symbols.push(t):R.push({id:e,symbols:[t]})}function i(e,t){var r=void 0;switch(e){case"events":r=V.events;break;case"marketDepth":r=V.marketDepth[t.symbol];break;case"marketUpdate":r=V.marketUpdate[t.symbol];break;case"timestamp":r=V.timestamp}r&&r.forEach(function(e){return e(t)})}function a(e,t,o){j||D||(q.username=t,q.password=o,q.server=e,window.WebSocket?(E=r.disconnected,j=new WebSocket("wss://"+q.server+"/jerq"),j.onclose=function(e){console.warn(new Date+" connection closed."),j=null,E===r.authenticated&&(E=r.disconnected,i("events",{event:"disconnect"}),setTimeout(function(){j=null,a(q.server,q.username,q.password),u.keys(F).forEach(function(e){n("MU_GO",e)}),u.keys(z).forEach(function(e){n("MU_GO",e)}),u.keys(A).forEach(function(e){n("MD_GO",e)})},d))},j.onmessage=function(e){H.push(e.data)},j.onopen=function(e){console.log(new Date+" connection open.")}):console.warn("Websockets are not supported by this browser."))}function o(){E=r.disconnected,null!==j&&(j.send("LOGOUT\r\n"),j.close(),j=null)}function c(){o(),R=[],B=[],L=[],A={},F={},z={}}function m(e){if(E===r.disconnected&&(E=r.connecting),E===r.connecting){var n=e.split("\n");n.forEach(function(e){"+++"==e&&(E=r.authenticating,B.push("LOGIN "+q.username+":"+q.password+" VERSION="+t+"\r\n"))})}else if(E===r.authenticating){var a=e.charAt(0);"+"===a?(E=r.authenticated,i("events",{event:"login success"})):"-"===a&&(c(),i("events",{event:"login fail"}))}E===r.authenticated&&L.push(e)}function p(){if(arguments.length<2)throw new Error("Bad number of arguments. Must pass in an eventId and handler.");var e=arguments[0],t=arguments[1],r=void 0;r=arguments.length>2?arguments[2]:null;var i=function(e){var r=e||[];return r.filter(function(e){return e!==t})},a=function(e,t){return t.reduce(function(t,r){return t||r.hasOwnProperty(e)},!1)},o=function(e,t,o,u,c){var l=r,f=s.symbolParser.getProducerSymbol(l),d=o[l]||[],m=i(d);if(o[l]=m,d.length>0&&0===m.length){delete o[l];var p=!0,v=!0,h=U[f]||[];a(l,c)||(p=!0),p&&(h=h.filter(function(e){var t=e!==l;return!t&&a(e,[o])&&(v=!1),t}),U[f]=h),v&&(delete e[f],u.forEach(function(e){e.hasOwnProperty(f)&&(v=!1)}),v&&n(t,f))}};switch(e){case"events":V.events=i(V.events);break;case"marketDepth":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('marketDepth', handler, symbol)");o(A,"MD_STOP",V.marketDepth,[],[]);break;case"marketUpdate":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('marketUpdate', handler, symbol)");o(F,"MU_STOP",V.marketUpdate,[z],[V.cumulativeVolume]);break;case"cumulativeVolume":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('cumulativeVolume', handler, symbol)");o(z,"MU_STOP",V.cumulativeVolume,[F],[V.marketUpdate]),x.getCumulativeVolume(r,function(e){e.off("events",t)});break;case"timestamp":V.timestamp=i(V.timestamp)}}function v(){if(arguments.length<2)throw new Error("Bad number of arguments. Must pass in an eventId and handler.");var e=arguments[0],t=arguments[1],r=void 0;r=arguments.length>2?arguments[2]:null;var i=function(e){e=e||[];var r=!e.some(function(e){return e===t}),n=void 0;return r?(n=e.slice(0),n.push(t)):n=e,n},a=function(e,t,a,o){var u=r,c=s.symbolParser.getProducerSymbol(u);a[u]=i(a[u]);var l=U[c]||[],f=!l.some(function(e){return e===u});if(f&&(l=l.slice(0),l.push(u),U[c]=l),!e[c]){e[c]=!0;var d=!o.some(function(e){return e[c]});d&&n(t,c)}};switch(e){case"events":V.events=i(V.events);break;case"marketDepth":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('marketDepth', handler, symbol)");a(A,"MD_GO",V.marketDepth,[]),x.getBook(r)&&t({type:"INIT",symbol:r});break;case"marketUpdate":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('marketUpdate', handler, symbol)");a(F,"MU_GO",V.marketUpdate,[z]),x.getQuote(r)&&t({type:"INIT",symbol:r});break;case"cumulativeVolume":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('cumulativeVolume', handler, symbol)");a(z,"MU_GO",V.cumulativeVolume,[F]),x.getCumulativeVolume(r,function(e){e.on("events",t)});break;case"timestamp":V.timestamp=i(V.timestamp)}}function h(e){switch(x.processMessage(e),e.type){case"BOOK":i("marketDepth",e);break;case"TIMESTAMP":i("timestamp",x.getTimestamp());break;default:i("marketUpdate",e)}}function b(e){var t=void 0;try{if(t=l(e),t.type)if(t.symbol){var r=U[t.symbol]||[];r.forEach(function(e){var r=void 0;e===t.symbol?r=t:(r=Object.assign({},t),r.symbol=e),h(r)})}else h(t);else console.log(e)}catch(n){console.error(n),console.log(t)}}function y(){for(var e=B.shift();e;)console.log(e),j.send(e),e=B.shift();setTimeout(y,200)}function g(){for(var e=9,t=!1;!t;){var r=L.shift();if(r){var n=!1,i=1,a=-1,o=r.indexOf(f.etx),s=r.indexOf(f.lf);if(s>-1&&(o<0||s<o)?(a=s,i=2):o>-1&&(a=o),a>-1){var u=a+1;if(1==i&&(r.length<a+e+1?(L.length>0?L[0]=r+L[0]:(L.unshift(r),t=!0),n=!0):r.substr(a+1,1)==f.dc4&&(u+=e+1)),!n){var c=r.substring(0,u);2==i?c=c.trim():(a=c.indexOf(f.soh),a>0&&(c=c.substring(a))),c.length>0&&b(c),r=r.substring(u),r.length>0&&(L.length>0?L[0]=r+L[0]:L.unshift(r))}}else r.length>0&&(L.length>0?L[0]=r+L[0]:(L.unshift(r),t=!0))}else t=!0;0===L.length&&(t=!0)}setTimeout(g,125)}function P(){for(var e=H.shift();e;)m(e),e=H.shift();setTimeout(P,125)}function k(){if(E===r.authenticated)for(;R.length>0;){var e=R.shift(),t="",n="";switch(e.id){case"MD_GO":t="GO",n="Bb";break;case"MU_GO":t="GO",n="Ssc";break;case"MD_STOP":t="STOP",n="Bb";break;case"MU_STOP":t="STOP",n="Ssc"}B.push(t+" "+e.symbols.join(",")+"="+n)}M=setTimeout(k,250)}function w(){if(E===r.authenticated&&0===B.length){R=[];var e=function(e){for(var t=[];0!==e.length;)t.push(e.splice(0,250));return t},t=e(_([F,z]));t.forEach(function(e){B.push("GO "+e.join(",")+"=sc")});e(u.keys(A));t.forEach(function(e){B.push("GO "+e.join(",")+"=b")})}M=setTimeout(w,N)}function I(e){N=e,O(),o()}function _(e){return u.keys(e.reduce(function(e,t){for(var r in t)t[r]===!0&&(e[r]=!0);return e},{}))}function T(){return _([F,A,z]).length}function O(){null!==M&&clearTimeout(M);var e=void 0;(e=N?w:k)()}function S(e,t,r){D=!1,a(e,t,r)}function C(){D=!0,c()}var x=e,E=r.disconnected,D=!1,N=null,M=null,j=null,U={},A={},F={},z={},R=[],B=[],L=[],H=[],V={events:[],marketDepth:{},marketUpdate:{},cumulativeVolume:{},timestamp:[]},q={username:null,password:null,server:null};return setTimeout(y,200),setTimeout(P,125),setTimeout(g,125),O(),{connect:S,disconnect:C,off:p,on:v,getActiveSymbolCount:T,setPollingFrequency:I}}var t=4,r={connecting:"CONNECTING",authenticating:"LOGGING_IN",authenticated:"LOGGED_IN",disconnected:"DISCONNECTED"},f={soh:"",etx:"",lf:"\n",dc4:""},d=5e3,m=function(t){function r(){n(this,r);var t=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t._internal=e(t.getMarketState()),t}return a(r,t),o(r,[{key:"_connect",value:function(){this._internal.connect(this.getServer(),this.getUsername(),this.getPassword())}},{key:"_disconnect",value:function(){this._internal.disconnect()}},{key:"_on",value:function(){this._internal.on.apply(this._internal,arguments)}},{key:"_off",value:function(){this._internal.off.apply(this._internal,arguments)}},{key:"_getActiveSymbolCount",value:function(){return this._internal.getActiveSymbolCount()}},{key:"_onPollingFrequencyChanged",value:function(e){return this._internal.setPollingFrequency(e)}},{key:"toString",value:function(){return"[Connection]"}}]),r}(c);return m}()},{"./../../../common/lang/object":1,"./../../../messageParser/parseMessage":20,"./../../ConnectionBase":3,"barchart-marketdata-utilities":36}],12:[function(e,t,r){"use strict";var n=e("./../connection/HistoricalDataProvider");t.exports=function(){return n}()},{"./../connection/HistoricalDataProvider":4}],13:[function(e,t,r){"use strict";var n=e("./connection/index"),i=e("./historicalData/index"),a=e("./marketState/index"),o=e("./messageParser/index"),s=e("./util/index");t.exports=function(){return{Connection:n,historicalData:i,HistoricalData:i,MarketState:a,MessageParser:o,messageParser:o,Util:s,util:s,version:"0.0.0"}}()},{"./connection/index":10,"./historicalData/index":12,"./marketState/index":18,"./messageParser/index":19,"./util/index":27}],14:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../common/lang/object");t.exports=function(){var e={update:"update",reset:"reset"},t=function(){function t(e,r){n(this,t),this.symbol=e,this._tickIncrement=r,this._handlers=[],this._priceLevels={},this._highPrice=null,this._lowPrice=null}return i(t,[{key:"on",value:function(e,t){var n=this;if("events"===e){var i=this._handlers.indexOf(t);if(i<0){var a=this._handlers.slice(0);a.push(t),this._handlers=a,this.toArray().forEach(function(e){r(n,t,e)})}}}},{key:"off",value:function(e,t){if("events"===e){var r=this._handlers.indexOf(t);if(!(r<0)){var n=this._handlers.slice(0);n.splice(r,1),this._handlers=n}}}},{key:"getTickIncrement",value:function(){return this._tickIncrement}},{key:"getVolume",value:function(e){var t=e.toString(),r=this._priceLevels[t];return r?r.volume:0}},{key:"incrementVolume",value:function(e,t){if(this._highPrice&&this._lowPrice){if(e>this._highPrice){for(var r=this._highPrice+this._tickIncrement;r<e;r+=this._tickIncrement)o(this,this._handlers,s(this._priceLevels,r.toString(),r));this._highPrice=e}else if(e<this._lowPrice){for(var n=this._lowPrice-this._tickIncrement;n>e;n-=this._tickIncrement)o(this,this._handlers,s(this._priceLevels,n.toString(),n));this._lowPrice=e}}else this._lowPrice=this._highPrice=e;var i=e.toString(),a=this._priceLevels[i];a||(a=s(this._priceLevels,i,e)),a.volume+=t,o(this,this._handlers,a)}},{key:"reset",value:function(){var t=this;this._priceLevels={},this._highPrice=null,this._lowPrice=null,this._handlers.forEach(function(r){r({container:t,event:e.reset})})}},{key:"toArray",value:function(){var e=this,t=a.keys(this._priceLevels).map(function(t){var r=e._priceLevels[t];return{price:r.price,volume:r.volume}});return t.sort(function(e,t){return e.price-t.price}),t}},{key:"dispose",value:function(){this._priceLevels={},this._highPrice=null,this._lowPrice=null,this._handlers=[]}}],[{key:"clone",value:function u(e,r){var u=new t(e,r.getTickIncrement());return r.toArray().forEach(function(e){u.incrementVolume(e.price,e.volume)}),u}}]),t}(),r=function(t,r,n){try{r({container:t,event:e.update,price:n.price,volume:n.volume})}catch(i){console.error("An error was thrown by a cumulative volume observer.",i)}},o=function(e,t,n){t.forEach(function(t){r(e,t,n)})},s=function(e,t,r){var n={price:r,volume:0};return e[t]=n,n};return t}()},{"./../common/lang/object":1}],15:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("barchart-marketdata-utilities"),o=e("./CumulativeVolume"),s=e("./Profile"),u=e("./Quote"),c=e("./../util/convertDayCodeToNumber"),l=e("./../connection/ProfileProvider");t.exports=function(){function e(){var e={},t={},r={},n=void 0,i=new l,f=function(e){return i.loadProfileData(e).then(function(e){e.forEach(function(e){404!==e.status&&new s(e.lookup,e.symbol_description,e.exchange_channel,e.base_code.toString(),e.point_value,e.tick_increment)})})},d=function(t){var r=e[t];if(!r){r={symbol:t,bids:[],asks:[]};var n=a.symbolParser.getProducerSymbol(t),i=e[n];i&&(r.bids=i.bids.slice(0),r.asks=i.asks.slice(0)),e[t]=r}return r},m=function(e){var t=r[e];if(!t){t={container:null,callbacks:[]};var n=a.symbolParser.getProducerSymbol(e),i=r[n];i&&i.container&&(t.container=o.clone(e,i.container)),r[e]=t}return t},p=function(e){var r=t[e];if(!r){var n=a.symbolParser.getProducerSymbol(e),i=t[n];r=i?u.clone(e,i):new u(e),t[e]=r}return r},v=function(e){var t=s.Profiles[e];if(!t){var r=a.symbolParser.getProducerSymbol(e),n=s.Profiles[r];n&&(t=new s(e,n.name,n.exchange,n.unitcode,n.pointValue,n.tickIncrement))}return t},h=function(e){var t=e.symbol;if("TIMESTAMP"===e.type)return void(n=e.timestamp);if("BOOK"===e.type){var i=d(t);return i.asks=e.asks,void(i.bids=e.bids)}if("REFRESH_CUMULATIVE_VOLUME"==e.type){var a=m(t),u=a.container;if(u)u.reset();else{a.container=u=new o(t,e.tickIncrement);var l=a.callbacks||[];l.forEach(function(e){e(u)}),a.callbacks=null}return void e.priceLevels.forEach(function(e){u.incrementVolume(e.price,e.volume)})}var f=v(t);if(!f&&"REFRESH_QUOTE"!==e.type)return console.warn("No profile found for "+t),void console.log(e);var h=p(t);if(!h.day&&e.day&&(h.day=e.day,h.dayNum=c(h.day)),h.day&&e.day){var b=c(e.day);if(b>h.dayNum||h.dayNum-b>5)h.day=e.day,h.dayNum=b,h.flag="p",h.bidPrice=0,h.bidSize=void 0,h.askPrice=void 0,h.askSize=void 0,h.settlementPrice?h.previousPrice=h.settlementPrice:h.lastPrice&&(h.previousPrice=h.lastPrice),h.lastPrice=void 0,h.tradePrice=void 0,h.tradeSize=void 0,h.numberOfTrades=void 0,h.openPrice=void 0,h.highPrice=void 0,h.lowPrice=void 0,h.volume=void 0;else if(h.dayNum>b)return;var y=r[t];switch(e.type){case"HIGH":h.highPrice=e.value;break;case"LOW":h.lowPrice=e.value;break;case"OPEN":h.flag=void 0,h.openPrice=e.value,h.highPrice=e.value,h.lowPrice=e.value,h.lastPrice=e.value,y&&y.container&&y.container.reset();break;case"OPEN_INTEREST":h.openInterest=e.value;break;case"REFRESH_DDF":switch(e.subrecord){case"1":case"2":case"3":h.message=e,null===e.openPrice?h.openPrice=void 0:e.openPrice&&(h.openPrice=e.openPrice),null===e.highPrice?h.highPrice=void 0:e.highPrice&&(h.highPrice=e.highPrice),null===e.lowPrice?h.lowPrice=void 0:e.lowPrice&&(h.lowPrice=e.lowPrice),null===e.lastPrice?h.lastPrice=void 0:e.lastPrice&&(h.lastPrice=e.lastPrice),null===e.bidPrice?h.bidPrice=void 0:e.bidPrice&&(h.bidPrice=e.bidPrice),null===e.askPrice?h.askPrice=void 0:e.askPrice&&(h.askPrice=e.askPrice),null===e.previousPrice?h.previousPrice=void 0:e.previousPrice&&(h.previousPrice=e.previousPrice),null===e.settlementPrice?(h.settlementPrice=void 0,"s"==h.flag&&(h.flag=void 0)):e.settlementPrice&&(h.settlementPrice=e.settlementPrice),null===e.volume?h.volume=void 0:e.volume&&(h.volume=e.volume),null===e.openInterest?h.openInterest=void 0:e.openInterest&&(h.openInterest=e.openInterest),"1"==e.subsrecord&&(h.lastUpdate=e.time)}break;case"REFRESH_QUOTE":f=new s(t,e.name,e.exchange,e.unitcode,e.pointValue,e.tickIncrement),h.message=e,h.flag=e.flag,h.mode=e.mode,h.lastUpdate=e.lastUpdate,h.bidPrice=e.bidPrice,h.bidSize=e.bidSize,h.askPrice=e.askPrice,h.askSize=e.askSize,h.lastPrice=e.lastPrice,h.tradeSize=e.tradeSize,h.numberOfTrades=e.numberOfTrades,h.previousPrice=e.previousPrice,h.settlementPrice=e.settlementPrice,h.openPrice=e.openPrice,h.highPrice=e.highPrice,h.lowPrice=e.lowPrice,h.volume=e.volume,h.openInterest=e.openInterest,e.tradeTime?h.time=e.tradeTime:e.timeStamp&&(h.time=e.timeStamp);break;case"SETTLEMENT":h.lastPrice=e.value,h.settlement=e.value,"D"===e.element&&(h.flag="s");break;case"TOB":h.bidPrice=e.bidPrice,h.bidSize=e.bidSize,h.askPrice=e.askPrice,h.askSize=e.askSize,e.time&&(h.time=e.time);break;case"TRADE":for(h.flag=void 0,h.tradePrice=e.tradePrice,h.lastPrice=e.tradePrice,e.tradeSize&&(h.tradeSize=e.tradeSize,h.volume+=e.tradeSize),h.ticks.push({price:h.tradePrice,size:h.tradeSize});h.ticks.length>50;)h.ticks.shift();h.numberOfTrades||(h.numberOfTrades=0),h.numberOfTrades++,e.time&&(h.time=e.time),y&&y.container&&e.tradePrice&&e.tradeSize&&y.container.incrementVolume(h.tradePrice,h.tradeSize);break;case"TRADE_OUT_OF_SEQUENCE":e.tradeSize&&(h.volume+=e.tradeSize),y&&y.container&&e.tradePrice&&e.tradeSize&&y.container.incrementVolume(h.tradePrice,h.tradeSize);break;case"VOLUME":h.volume=e.value;break;case"VOLUME_YESTERDAY":break;case"VWAP":h.vwap1=e.value;break;default:console.error("Unhandled Market Message:"),console.log(e)}}},b=function(t){return e[t]},y=function(e,t){var r=m(e),n=void 0;return n=r.container?Promise.resolve(r.container):new Promise(function(e){r.callbacks.push(e)}),n.then(function(e){return"function"==typeof t&&t(e),e})},g=function(e,t){var r=v(e),n=void 0;return n=r?Promise.resolve(r):f([e]).then(function(){return s.Profiles[e]}),n.then(function(e){return"function"==typeof t&&t(e),e})},P=function(e){return t[e]},k=function(){return n};return{getBook:b,getCumulativeVolume:y,getProfile:g,getQuote:P,getTimestamp:k,processMessage:h}}var t=function(){function t(){n(this,t),this._internal=e()}return i(t,[{key:"getBook",value:function(e){return this._internal.getBook(e)}},{key:"getCumulativeVolume",value:function(e,t){return this._internal.getCumulativeVolume(e,t)}},{key:"getProfile",value:function(e,t){return this._internal.getProfile(e,t)}},{key:"getQuote",value:function(e){return this._internal.getQuote(e)}},{key:"getTimestamp",value:function(){return this._internal.getTimestamp()}},{key:"processMessage",value:function(e){return this._internal.processMessage(e)}}],[{key:"CumulativeVolume",get:function(){return o}},{key:"Profile",get:function(){return s}},{key:"Quote",get:function(){return u}}]),t}();return t}()},{"./../connection/ProfileProvider":6,"./../util/convertDayCodeToNumber":25,"./CumulativeVolume":14,"./Profile":16,"./Quote":17,"barchart-marketdata-utilities":36}],16:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../util/parseSymbolType"),o=e("./../util/priceFormatter");t.exports=function(){var e={},t=o("-",!0,",").format,r=function(){function r(t,i,o,s,u,c){n(this,r),this.symbol=t,this.name=i,this.exchange=o,this.unitCode=s,this.pointValue=u,this.tickIncrement=c;var l=a(this.symbol);l&&"future"===l.type&&(this.root=l.root,this.month=l.month,this.year=l.year),e[t]=this}return i(r,[{key:"formatPrice",value:function(e){return t(e)}}],[{key:"setPriceFormatter",value:function(e,r,n){t=o(e,r,n).format}},{key:"PriceFormatter",value:function(e,t,n){r.setPriceFormatter(e,t,n)}},{key:"Profiles",get:function(){return e}}]),r}();return r}()},{"./../util/parseSymbolType":29,"./../util/priceFormatter":30}],17:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(){var e=function(){function e(t){n(this,e),this.symbol=t||null,this.message=null,this.flag=null,this.mode=null,this.day=null,this.dayNum=0,this.session=null,this.lastUpdate=null,this.bidPrice=null,this.bidSize=null,this.askPrice=null,this.askSize=null,this.lastPrice=null,this.tradePrice=null,this.tradeSize=null,this.numberOfTrades=null,this.vwap1=null,this.vwap2=null,this.settlementPrice=null,this.openPrice=null,this.highPrice=null,this.lowPrice=null,this.volume=null,this.openInterest=null,this.previousPrice=null,this.time=null,this.ticks=[]}return i(e,null,[{key:"clone",value:function t(e,r){var t=Object.assign({},r);return t.symbol=e,t}}]),e}();return e}()},{}],18:[function(e,t,r){"use strict";var n=e("./MarketState");t.exports=function(){return n}()},{"./MarketState":15}],19:[function(e,t,r){"use strict";var n=e("./parseMessage"),i=e("./parseTimestamp"),a=e("./parseValue");t.exports=function(){return{parseMessage:n,parseTimestamp:i,parseValue:a,Parse:n,ParseTimestamp:i,ParseValue:a}}()},{"./parseMessage":20,"./parseTimestamp":21,"./parseValue":22}],20:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.messageParser}()},{"barchart-marketdata-utilities":36}],21:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.timestampParser}()},{"barchart-marketdata-utilities":36}],22:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.priceParser}()},{"barchart-marketdata-utilities":36}],23:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.convert.baseCodeToUnitCode}()},{"barchart-marketdata-utilities":36}],24:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.convert.dateToDayCode}()},{"barchart-marketdata-utilities":36}],25:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.convert.dayCodeToNumber}()},{"barchart-marketdata-utilities":36}],26:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.convert.unitCodeToBaseCode}()},{"barchart-marketdata-utilities":36}],27:[function(e,t,r){"use strict";var n=e("./convertBaseCodeToUnitCode"),i=e("./convertDateToDayCode"),a=e("./convertDayCodeToNumber"),o=e("./convertUnitCodeToBaseCode"),s=e("./monthCodes"),u=e("./parseSymbolType"),c=e("./priceFormatter"),l=e("./timeFormatter");t.exports=function(){return{convertBaseCodeToUnitCode:n,convertUnitCodeToBaseCode:o,convertDateToDayCode:i,convertDayCodeToNumber:a,monthCodes:s,parseSymbolType:u,BaseCode2UnitCode:n,DateToDayCode:i,DayCodeToNumber:a,MonthCodes:s,ParseSymbolType:u,PriceFormatter:c,TimeFormatter:l,UnitCode2BaseCode:o}}()},{"./convertBaseCodeToUnitCode":23,"./convertDateToDayCode":24,"./convertDayCodeToNumber":25,"./convertUnitCodeToBaseCode":26,"./monthCodes":28,"./parseSymbolType":29,"./priceFormatter":30,"./timeFormatter":31}],28:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.monthCodes.getCodeToNameMap()}()},{"barchart-marketdata-utilities":36}],29:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.symbolParser.parseInstrumentType}()},{"barchart-marketdata-utilities":36}],30:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.priceFormatter}()},{"barchart-marketdata-utilities":36}],31:[function(e,t,r){"use strict";var n=e("barchart-marketdata-utilities");t.exports=function(){return n.timeFormatter}()},{"barchart-marketdata-utilities":36}],32:[function(e,t,r){var n=e("class.extend");t.exports=function(){"use strict";return n.extend({init:function(){},parse:function(e){if("string"!=typeof e)throw new Error('The "textDocument" argument must be a string.');return this._parse(e)},
_parse:function(e){return null},toString:function(){return"[XmlDomParserBase]"}})}()},{"class.extend":45}],33:[function(e,t,r){var n=e("./../XmlDomParserBase");t.exports=function(){"use strict";return n.extend({init:function(){window.DOMParser?this._xmlDomParser=new DOMParser:this._xmlDomParser=null},_parse:function(e){var t;return this._xmlDomParser?t=this._xmlDomParser.parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},toString:function(){return"[XmlDomParser]"}})}()},{"./../XmlDomParserBase":32}],34:[function(e,t,r){t.exports=function(){"use strict";return{unitCodeToBaseCode:function(e){switch(e){case"2":return-1;case"3":return-2;case"4":return-3;case"5":return-4;case"6":return-5;case"7":return-6;case"8":return 0;case"9":return 1;case"A":return 2;case"B":return 3;case"C":return 4;case"D":return 5;case"E":return 6;case"F":return 7;default:return 0}},baseCodeToUnitCode:function(e){switch(e){case-1:return"2";case-2:return"3";case-3:return"4";case-4:return"5";case-5:return"6";case-6:return"7";case 0:return"8";case 1:return"9";case 2:return"A";case 3:return"B";case 4:return"C";case 5:return"D";case 6:return"E";case 7:return"F";default:return 0}},dateToDayCode:function(e){var t=e.getDate();return t>=1&&t<=9?String.fromCharCode("1".charCodeAt(0)+t-1):10==t?"0":String.fromCharCode("A".charCodeAt(0)+t-11)},dayCodeToNumber:function(e){var t=parseInt(e,31);return t>9?t++:0===t&&(t=10),t}}}()},{}],35:[function(e,t,r){var n=e("lodash.isnan");t.exports=function(){"use strict";return function(e,t,r,i){if(""===e||void 0===e||null===e||n(e))return"";var a=e<0&&i===!0;a&&(e=0-e);var o=e.toFixed(t);if(!r||e>-1e3&&e<1e3)a&&(o="("+o+")");else{for(var s=o.length,u=e<0,c=0===t,l=0,f=[],d=s-1;!(d<0);d--){3!==l||u&&0===d||(f.unshift(r),l=0);var m=o.charAt(d);f.unshift(m),c?l+=1:"."===m&&(c=!0)}a&&(f.unshift("("),f.push(")")),o=f.join("")}return o}}()},{"lodash.isnan":49}],36:[function(e,t,r){var n=e("./convert"),i=e("./decimalFormatter"),a=e("./messageParser"),o=e("./monthCodes"),s=e("./priceFormatter"),u=e("./symbolFormatter"),c=e("./symbolParser"),l=e("./priceParser"),f=e("./timeFormatter"),d=e("./timestampParser");t.exports=function(){"use strict";return{convert:n,decimalFormatter:i,monthCodes:o,messageParser:a,priceFormatter:s,symbolParser:c,priceParser:l,symbolFormatter:u,timeFormatter:f,timestampParser:d}}()},{"./convert":34,"./decimalFormatter":35,"./messageParser":37,"./monthCodes":38,"./priceFormatter":39,"./priceParser":40,"./symbolFormatter":41,"./symbolParser":42,"./timeFormatter":43,"./timestampParser":44}],37:[function(e,t,r){var n=e("./common/xml/XmlDomParser"),i=e("./priceParser"),a=e("./timestampParser");t.exports=function(){"use strict";return function(e){var t={message:e,type:null};switch(e.substr(0,1)){case"%":var r;try{var o=new n;r=o.parse(e.substring(1))}catch(s){r=void 0}if(r){var u=r.firstChild;switch(u.nodeName){case"BOOK":t.symbol=u.attributes.getNamedItem("symbol").value,t.unitcode=u.attributes.getNamedItem("basecode").value,t.askDepth=parseInt(u.attributes.getNamedItem("bidcount").value),t.bidDepth=parseInt(u.attributes.getNamedItem("bidcount").value),t.asks=[],t.bids=[];var c,l;if(u.attributes.getNamedItem("askprices")&&u.attributes.getNamedItem("asksizes")){c=u.attributes.getNamedItem("askprices").value.split(","),l=u.attributes.getNamedItem("asksizes").value.split(",");for(var f=0;f<c.length;f++)t.asks.push({price:i(c[f],t.unitcode),size:parseInt(l[f])})}if(u.attributes.getNamedItem("bidprices")&&u.attributes.getNamedItem("bidsizes")){c=u.attributes.getNamedItem("bidprices").value.split(","),l=u.attributes.getNamedItem("bidsizes").value.split(",");for(var f=0;f<c.length;f++)t.bids.push({price:i(c[f],t.unitcode),size:parseInt(l[f])})}t.type="BOOK";break;case"QUOTE":for(var f=0;f<u.attributes.length;f++){switch(u.attributes[f].name){case"symbol":t.symbol=u.attributes[f].value;break;case"name":t.name=u.attributes[f].value;break;case"exchange":t.exchange=u.attributes[f].value;break;case"basecode":t.unitcode=u.attributes[f].value;break;case"pointvalue":t.pointValue=parseFloat(u.attributes[f].value);break;case"tickincrement":t.tickIncrement=parseInt(u.attributes[f].value);break;case"flag":t.flag=u.attributes[f].value;break;case"lastupdate":var d=u.attributes[f].value;t.lastUpdate=new Date(parseInt(d.substr(0,4)),parseInt(d.substr(4,2))-1,parseInt(d.substr(6,2)),parseInt(d.substr(8,2)),parseInt(d.substr(10,2)),parseInt(d.substr(12,2)));break;case"bid":t.bidPrice=i(u.attributes[f].value,t.unitcode);break;case"bidsize":t.bidSize=parseInt(u.attributes[f].value);break;case"ask":t.askPrice=i(u.attributes[f].value,t.unitcode);break;case"asksize":t.askSize=parseInt(u.attributes[f].value);break;case"mode":t.mode=u.attributes[f].value}for(var m={},p=0;p<u.childNodes.length;p++)if("SESSION"==u.childNodes[p].nodeName){var v={},h=u.childNodes[p].attributes;if(h.getNamedItem("id")&&(v.id=h.getNamedItem("id").value),h.getNamedItem("day")&&(v.day=h.getNamedItem("day").value),h.getNamedItem("last")&&(v.lastPrice=i(h.getNamedItem("last").value,t.unitcode)),h.getNamedItem("previous")&&(v.previousPrice=i(h.getNamedItem("previous").value,t.unitcode)),h.getNamedItem("open")&&(v.openPrice=i(h.getNamedItem("open").value,t.unitcode)),h.getNamedItem("high")&&(v.highPrice=i(h.getNamedItem("high").value,t.unitcode)),h.getNamedItem("low")&&(v.lowPrice=i(h.getNamedItem("low").value,t.unitcode)),h.getNamedItem("tradesize")&&(v.tradeSize=parseInt(h.getNamedItem("tradesize").value)),h.getNamedItem("numtrades")&&(v.numberOfTrades=parseInt(h.getNamedItem("numtrades").value)),h.getNamedItem("settlement")&&(v.settlementPrice=i(h.getNamedItem("settlement").value,t.unitcode)),h.getNamedItem("volume")&&(v.volume=parseInt(h.getNamedItem("volume").value)),h.getNamedItem("openinterest")&&(v.openInterest=parseInt(h.getNamedItem("openinterest").value)),h.getNamedItem("timestamp")){var d=h.getNamedItem("timestamp").value;v.timeStamp=new Date(parseInt(d.substr(0,4)),parseInt(d.substr(4,2))-1,parseInt(d.substr(6,2)),parseInt(d.substr(8,2)),parseInt(d.substr(10,2)),parseInt(d.substr(12,2)))}if(h.getNamedItem("tradetime")){var d=h.getNamedItem("tradetime").value;v.tradeTime=new Date(parseInt(d.substr(0,4)),parseInt(d.substr(4,2))-1,parseInt(d.substr(6,2)),parseInt(d.substr(8,2)),parseInt(d.substr(10,2)),parseInt(d.substr(12,2)))}v.id&&(m[v.id]=v)}var b="undefined"==typeof m.combined.lastPrice,y=!b&&"undefined"!=typeof m.combined.settlementPrice,g=b?m.previous:m.combined;g.lastPrice&&(t.lastPrice=g.lastPrice),g.previousPrice&&(t.previousPrice=g.previousPrice),g.openPrice&&(t.openPrice=g.openPrice),g.highPrice&&(t.highPrice=g.highPrice),g.lowPrice&&(t.lowPrice=g.lowPrice),g.tradeSize&&(t.tradeSize=g.tradeSize),g.numberOfTrades&&(t.numberOfTrades=g.numberOfTrades),g.settlementPrice&&(t.settlementPrice=g.settlementPrice),g.volume&&(t.volume=g.volume),g.openInterest&&(t.openInterest=g.openInterest),"combined"===g.id&&m.previous.openInterest&&(t.openInterest=m.previous.openInterest),g.timeStamp&&(t.timeStamp=g.timeStamp),g.tradeTime&&(t.tradeTime=g.tradeTime),m.combined.day&&(t.day=m.combined.day),b&&"undefined"==typeof t.flag&&(t.flag="p");var P=m.previous;if(t.previousPreviousPrice=P.previousPrice,t.previousSettlementPrice=P.settlementPrice,t.previousOpenPrice=P.openPrice,t.previousHighPrice=P.highPrice,t.previousLowPrice=P.lowPrice,t.previousTimeStamp=P.timeStamp,m.combined.day){var k="session_"+m.combined.day+"_T";if(m.hasOwnProperty(k)){var w=m[k],I=w.lastPrice;if(I){var _,T=w.tradeTime,O=w.tradeSize;if(T){var S=new Date(T.getFullYear(),T.getMonth(),T.getDate(),12,0,0,0);_=T.getTime()>S.getTime()}else _=!1;t.sessionT=_;var C=b||_;C&&(t.lastPriceT=I),(b||y)&&(t.session="T",C&&(T&&(t.tradeTime=T),O&&(t.tradeSize=O)),b&&(w.volume&&(t.volume=w.volume),w.previousPrice&&(t.previousPrice=w.previousPrice)))}}}}t.type="REFRESH_QUOTE";break;case"CV":t.type="REFRESH_CUMULATIVE_VOLUME",t.symbol=u.attributes.getNamedItem("symbol").value,t.unitCode=u.attributes.getNamedItem("basecode").value,t.tickIncrement=i(u.attributes.getNamedItem("tickincrement").value,t.unitCode);var x=u.attributes.getNamedItem("data");if(x){for(var E=x.value||"",D=E.split(":"),f=0;f<D.length;f++){var N=D[f],M=N.split(",");D[f]={price:i(M[0],t.unitCode),volume:parseInt(M[1])}}D.sort(function(e,t){return e.price-t.price}),t.priceLevels=D}else t.priceLevels=[];break;default:console.log(e)}}break;case"":switch(e.substr(1,1)){case"#":t.type="TIMESTAMP",t.timestamp=new Date(parseInt(e.substr(2,4)),parseInt(e.substr(6,2))-1,parseInt(e.substr(8,2)),parseInt(e.substr(10,2)),parseInt(e.substr(12,2)),parseInt(e.substr(14,2)));break;case"2":t.record="2";var j=e.indexOf(",",0);switch(t.symbol=e.substring(2,j),t.subrecord=e.substr(j+1,1),t.unitcode=e.substr(j+3,1),t.exchange=e.substr(j+4,1),t.delay=parseInt(e.substr(j+5,2)),t.subrecord){case"0":var U=e.indexOf(",",j+7);switch(t.value=i(e.substring(j+7,U),t.unitcode),t.element=e.substr(U+1,1),t.modifier=e.substr(U+2,1),t.element){case"A":t.type="OPEN";break;case"C":"1"==t.modifier&&(t.type="OPEN_INTEREST");break;case"D":case"d":"0"==t.modifier&&(t.type="SETTLEMENT");break;case"V":"0"==t.modifier&&(t.type="VWAP");break;case"0":"0"==t.modifier&&(t.tradePrice=t.value,t.type="TRADE");break;case"5":t.type="HIGH";break;case"6":t.type="LOW";break;case"7":"1"==t.modifier?t.type="VOLUME_YESTERDAY":"6"==t.modifier&&(t.type="VOLUME")}t.day=e.substr(U+3,1),t.session=e.substr(U+4,1),t.time=a(e.substr(e.indexOf("")+1,9));break;case"1":case"2":case"3":case"4":var A=e.substring(j+8).split(",");t.openPrice=i(A[0],t.unitcode),t.highPrice=i(A[1],t.unitcode),t.lowPrice=i(A[2],t.unitcode),t.lastPrice=i(A[3],t.unitcode),t.bidPrice=i(A[4],t.unitcode),t.askPrice=i(A[5],t.unitcode),t.previousPrice=i(A[7],t.unitcode),t.settlementPrice=i(A[10],t.unitcode),t.volume=A[13].length>0?parseInt(A[13]):void 0,t.openInterest=A[12].length>0?parseInt(A[12]):void 0,t.day=A[14].substr(0,1),t.session=A[14].substr(1,1),t.time=a(e.substr(e.indexOf("")+1,9)),t.type="REFRESH_DDF";break;case"7":var U=e.indexOf(",",j+7);t.tradePrice=i(e.substring(j+7,U),t.unitcode),j=U+1,U=e.indexOf(",",j),t.tradeSize=parseInt(e.substring(j,U)),j=U+1,t.day=e.substr(j,1),t.session=e.substr(j+1,1),t.time=a(e.substr(e.indexOf("")+1,9)),t.type="TRADE";break;case"8":var U=e.indexOf(",",j+7);t.bidPrice=i(e.substring(j+7,U),t.unitcode),j=U+1,U=e.indexOf(",",j),t.bidSize=parseInt(e.substring(j,U)),j=U+1,U=e.indexOf(",",j),t.askPrice=i(e.substring(j,U),t.unitcode),j=U+1,U=e.indexOf(",",j),t.askSize=parseInt(e.substring(j,U)),j=U+1,t.day=e.substr(j,1),t.session=e.substr(j+1,1),t.time=a(e.substr(e.indexOf("")+1,9)),t.type="TOB";break;case"Z":var U=e.indexOf(",",j+7);t.tradePrice=i(e.substring(j+7,U),t.unitcode),j=U+1,U=e.indexOf(",",j),t.tradeSize=parseInt(e.substring(j,U)),j=U+1,t.day=e.substr(j,1),t.session=e.substr(j+1,1),t.time=a(e.substr(e.indexOf("")+1,9)),t.type="TRADE_OUT_OF_SEQUENCE"}break;case"3":var j=e.indexOf(",",0);switch(t.symbol=e.substring(2,j),t.subrecord=e.substr(j+1,1),t.subrecord){case"B":t.unitcode=e.substr(j+3,1),t.exchange=e.substr(j+4,1),t.bidDepth="A"==e.substr(j+5,1)?10:parseInt(e.substr(j+5,1)),t.askDepth="A"==e.substr(j+6,1)?10:parseInt(e.substr(j+6,1)),t.bids=[],t.asks=[];for(var A=e.substring(j+8).split(","),f=0;f<A.length;f++){var l=A[f].split(/[A-Z]/),F=A[f].substr(l[0].length,1);F<="J"?t.asks.push({price:i(l[0],t.unitcode),size:parseInt(l[1])}):t.bids.push({price:i(l[0],t.unitcode),size:parseInt(l[1])})}t.type="BOOK"}break;default:t.type="UNKNOWN"}}return t}}()},{"./common/xml/XmlDomParser":33,"./priceParser":40,"./timestampParser":44}],38:[function(e,t,r){t.exports=function(){"use strict";var e={},t={},r=function(r,n,i){e[r]=n,t[r]=i};return r("F","January",1),r("G","February",2),r("H","March",3),r("J","April",4),r("K","May",5),r("M","June",6),r("N","July",7),r("Q","August",8),r("U","September",9),r("V","October",10),r("X","November",11),r("Z","December",12),r("Y","Cash",0),{getCodeToNameMap:function(){return e},getCodeToNumberMap:function(){return t}}}()},{}],39:[function(e,t,r){var n=e("lodash.isnan"),i=e("./decimalFormatter");t.exports=function(){"use strict";function e(e,t){return["000",Math.floor(e)].join("").substr(-1*t)}return function(t,r,a,o){function s(e){var r=Math.floor(e);return 0===r&&""===t?"":r}function u(e,t){return i(e,t,a,o)}var c;return c="."===t?function(e,t){switch(t){case"2":return u(e,3);case"3":return u(e,4);case"4":return u(e,5);case"5":return u(e,6);case"6":return u(e,7);case"7":return u(e,8);case"8":return u(e,0);case"9":return u(e,1);case"A":return u(e,2);case"B":return u(e,3);case"C":return u(e,4);case"D":return u(e,5);case"E":return u(e,6);default:return""===e||void 0===e||null===e||n(e)?"":e}}:function(i,a){if(""===i||void 0===i||null===i||n(i))return"";var c,l,f=i,d=i<0,i=Math.abs(i);switch(d?o===!0?(c="(",l=")"):(c="-",l=""):(c="",l=""),a){case"2":return[c,s(i),t,e(8*(i-Math.floor(i)),1),l].join("");case"3":return[c,s(i),t,e(16*(i-Math.floor(i)),2),l].join("");case"4":return[c,s(i),t,e(32*(i-Math.floor(i)),2),l].join("");case"5":return[c,s(i),t,e((i-Math.floor(i))*(r?320:64),r?3:2),l].join("");case"6":return[c,s(i),t,e((i-Math.floor(i))*(r?320:128),3),l].join("");case"7":return[c,s(i),t,e((i-Math.floor(i))*(r?320:256),3),l].join("");case"8":return u(f,0);case"9":return u(f,1);case"A":return u(f,2);case"B":return u(f,3);case"C":return u(f,4);case"D":return u(f,5);case"E":return u(f,6);default:return f}},{format:c}}}()},{"./decimalFormatter":35,"lodash.isnan":49}],40:[function(e,t,r){t.exports=function(){"use strict";function e(e){return t.hasOwnProperty(e)||(t[e]=new RegExp(e,"g")),t[e]}var t={};return function(t,r,n){if(!(t.length<1)){if("-"===t)return null;if(n&&(t=t.replace(e(n),"")),!(t.indexOf(".")<0))return parseFloat(t);var i="-"==t.substr(0,1)?-1:1;switch(i===-1&&(t=t.substr(1)),r){case"2":return i*((t.length>1?parseInt(t.substr(0,t.length-1)):0)+parseInt(t.substr(-1))/8);case"3":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/16);case"4":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/32);case"5":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/64);case"6":return i*((t.length>3?parseInt(t.substr(0,t.length-3)):0)+parseInt(t.substr(-3))/128);case"7":return i*((t.length>3?parseInt(t.substr(0,t.length-3)):0)+parseInt(t.substr(-3))/256);case"8":return i*parseInt(t);case"9":return i*(parseInt(t)/10);case"A":return i*(parseInt(t)/100);case"B":return i*(parseInt(t)/1e3);case"C":return i*(parseInt(t)/1e4);case"D":return i*(parseInt(t)/1e5);case"E":return i*(parseInt(t)/1e6);default:return i*parseInt(t)}}}}()},{}],41:[function(e,t,r){t.exports=function(){"use strict";return{format:function(e){var t;return t=null!==e&&"string"==typeof e?e.toUpperCase():e}}}()},{}],42:[function(e,t,r){t.exports=function(){"use strict";var e=/^(.*)\\.([A-Z]{1,4})$/i,t=/(.{1,3})([A-Z]{1})([0-9]{3}|[0-9]{1})?([0-9]{1})$/i,r=/^(.{1,3})([A-Z]{1})([0-9]{4}|[0-9]{1,2})$/i,n=/^(.{1,3})(\*{1})([0-9]{1})$/i,i=/^_S_/i,a=/^\^([A-Z]{3})([A-Z]{3})$/i,o=/^\-(.*)$/i,s=/^\$(.*)$/i,u=/^(.*)\.BZ$/i,c=/(\.RT)$/,l={parseInstrumentType:function(t){if("string"!=typeof t)return null;var u=t.match(e);if(null!==u&&(t=u[1]),i.test(t))return{symbol:t,type:"future_spread"};var c=t.match(r);if(null!==c){var l=new Date,f=l.getFullYear(),d=c[3],m=parseInt(d);if(m<10)m=10*Math.floor(f/10)+m;else if(m<100&&(m=100*Math.floor(f/100)+m,m<f)){var p=m+100;f-m>p-f&&(m=p)}return{symbol:t,type:"future",root:c[1],dynamic:!1,month:c[2],year:m}}var v=t.match(n);if(null!==v)return{symbol:t,type:"future",root:v[1],dynamic:!0,dynamicCode:v[3]};var h=t.match(a);if(null!==h)return{symbol:t,type:"forex"};var b=t.match(s);if(null!==b)return{symbol:t,type:"index"};var y=t.match(o);return null!==y?{symbol:t,type:"sector"}:null},getIsConcrete:function(e){return!this.getIsReference(e)},getIsReference:function(e){return n.test(e)},getIsFuture:function(e){return f(e,"future")},getIsFutureSpread:function(e){return f(e,"future_spread")},getIsForex:function(e){return f(e,"forex")},getIsSector:function(e){return f(e,"sector")},getIsIndex:function(e){return f(e,"index")},getIsBats:function(e){return u.test(e)},getProducerSymbol:function(e){var r;return r="string"==typeof e?e.replace(t,"$1$2$4"):null},displayUsingPercent:function(e){return c.test(e)}},f=function(e,t){var r=l.parseInstrumentType(e);return null!==r&&r.type===t};return l}()},{}],43:[function(e,t,r){t.exports=function(){"use strict";function e(e){var t,r=e.getHours();return 0===r?(r=12,t="AM"):12===r?(r=r,t="PM"):r>12?(r-=12,t="PM"):(r=r,t="AM"),i(r)+":"+i(e.getMinutes())+":"+i(e.getSeconds())+" "+t}function t(e){var t,r=e.getHours();return 0===r?(r=12,t="A"):12===r?(r=r,t="P"):r>12?(r-=12,t="P"):(r=r,t="A"),i(r)+":"+i(e.getMinutes())+t}function r(e){return i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())}function n(e){return i(e.getHours())+":"+i(e.getMinutes())}function i(e){return("00"+e).substr(-2)}return function(a,o){var s;s=a?o?t:e:o?n:r;var u={format:function(e){var t=e.time;return t?!e.lastPrice||e.flag||e.sessionT?u.formatDate(t):u.formatTime(t,e.timezone):""},formatTime:function(e,t){var r;return e?(r=s(e),t&&(r=r+" "+t)):r="",r},formatDate:function(e){return e?i(e.getMonth()+1)+"/"+i(e.getDate())+"/"+i(e.getFullYear()):""}};return u}}()},{}],44:[function(e,t,r){t.exports=function(){"use strict";return function(e){if(9!==e.length)return null;var t=100*e.charCodeAt(0)+e.charCodeAt(1)-64,r=e.charCodeAt(2)-64-1,n=e.charCodeAt(3)-64,i=e.charCodeAt(4)-64,a=e.charCodeAt(5)-64,o=e.charCodeAt(6)-64,s=(255&e.charCodeAt(7))+((255&e.charCodeAt(8))<<8);return new Date(t,r,n,i,a,o,s)}}()},{}],45:[function(e,t,r){!function(){var e=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(t){function n(){!e&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;e=!0;var a=new this;e=!1;for(var o in t)a[o]="function"==typeof t[o]&&"function"==typeof i[o]&&r.test(t[o])?function(e,t){return function(){var r=this._super;this._super=i[e];var n=t.apply(this,arguments);return this._super=r,n}}(o,t[o]):t[o];return n.prototype=a,n.prototype.constructor=n,n.extend=arguments.callee,n},t.exports=Class}()},{}],46:[function(e,t,r){function n(e,t,r){if(!s(t))throw new TypeError("iterator must be a function");arguments.length<3&&(r=this),"[object Array]"===u.call(e)?i(e,t,r):"string"==typeof e?a(e,t,r):o(e,t,r)}function i(e,t,r){for(var n=0,i=e.length;n<i;n++)c.call(e,n)&&t.call(r,e[n],n,e)}function a(e,t,r){for(var n=0,i=e.length;n<i;n++)t.call(r,e.charAt(n),n,e)}function o(e,t,r){for(var n in e)c.call(e,n)&&t.call(r,e[n],n,e)}var s=e("is-function");t.exports=n;var u=Object.prototype.toString,c=Object.prototype.hasOwnProperty},{"is-function":48}],47:[function(e,t,r){(function(e){var r;r="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,r){function n(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var i=Object.prototype.toString},{}],49:[function(e,t,r){function n(e){return!!e&&"object"==typeof e}function i(e){return a(e)&&e!=+e}function a(e){return"number"==typeof e||n(e)&&u.call(e)==o}var o="[object Number]",s=Object.prototype,u=s.toString;t.exports=i},{}],50:[function(e,t,r){var n=e("trim"),i=e("for-each"),a=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return i(n(e).split("\n"),function(e){var r=e.indexOf(":"),i=n(e.slice(0,r)).toLowerCase(),o=n(e.slice(r+1));"undefined"==typeof t[i]?t[i]=o:a(t[i])?t[i].push(o):t[i]=[t[i],o]}),t}},{"for-each":46,trim:51}],51:[function(e,t,r){function n(e){return e.replace(/^\s*|\s*$/g,"")}r=t.exports=n,r.left=function(e){return e.replace(/^\s*/,"")},r.right=function(e){return e.replace(/\s*$/,"")}},{}],52:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<e.length;r++)t(e[r])}function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function a(e,t,r){var n=e;return f(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=m(t,{uri:e}),n.callback=r,n}function o(e,t,r){return t=a(e,t,r),s(t)}function s(e){function t(){4===l.readyState&&a()}function r(){var e=void 0;if(e=l.response?l.response:l.responseText||u(l),P)try{e=JSON.parse(e)}catch(t){}return e}function n(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,c(e,k)}function a(){if(!m){var t;clearTimeout(p),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var n=k,i=null;return 0!==t?(n={body:r(),statusCode:t,method:h,headers:{},url:v,rawRequest:l},l.getAllResponseHeaders&&(n.headers=d(l.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),c(i,n,n.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var s=!1,c=function(t,r,n){s||(s=!0,e.callback(t,r,n))},l=e.xhr||null;l||(l=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var f,m,p,v=l.url=e.uri||e.url,h=l.method=e.method||"GET",b=e.body||e.data||null,y=l.headers=e.headers||{},g=!!e.sync,P=!1,k={body:void 0,headers:{},statusCode:0,method:h,url:v,rawRequest:l};if("json"in e&&e.json!==!1&&(P=!0,y.accept||y.Accept||(y.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(y["content-type"]||y["Content-Type"]||(y["Content-Type"]="application/json"),b=JSON.stringify(e.json===!0?b:e.json))),l.onreadystatechange=t,l.onload=a,l.onerror=n,l.onprogress=function(){},l.onabort=function(){m=!0},l.ontimeout=n,l.open(h,v,!g,e.username,e.password),g||(l.withCredentials=!!e.withCredentials),!g&&e.timeout>0&&(p=setTimeout(function(){if(!m){m=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)}},e.timeout)),l.setRequestHeader)for(f in y)y.hasOwnProperty(f)&&l.setRequestHeader(f,y[f]);else if(e.headers&&!i(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(b),l}function u(e){if("document"===e.responseType)return e.responseXML;var t=204===e.status&&e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function c(){}var l=e("global/window"),f=e("is-function"),d=e("parse-headers"),m=e("xtend");t.exports=o,o.XMLHttpRequest=l.XMLHttpRequest||c,o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:l.XDomainRequest,n(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,r,n){return r=a(t,r,n),r.method=e.toUpperCase(),s(r)}})},{"global/window":47,"is-function":48,"parse-headers":50,xtend:53}],53:[function(e,t,r){function n(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)i.call(r,n)&&(e[n]=r[n])}return e}t.exports=n;var i=Object.prototype.hasOwnProperty},{}]},{},[13])(13)});