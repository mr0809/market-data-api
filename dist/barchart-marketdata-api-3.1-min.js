!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Barchart||(t.Barchart={})).RealtimeData=e()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";t.exports=function(){var e={unique:function(e){var t=e||[];return t.filter(function(e,r){return t.indexOf(e)===r})}};return e}()},{}],2:[function(e,t,r){"use strict";t.exports=function(){var e={keys:function t(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}};return e}()},{}],3:[function(e,t,r){"use strict";var n=e("./websocket/Connection");t.exports=function(){return n}()},{"./websocket/Connection":6}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../marketState/MarketState");t.exports=function(){var e=function(){function e(){var t=this;n(this,e),this._server=null,this._username=null,this._password=null,this._marketState=new a(function(e){return t._handleProfileRequest(e)}),this._pollingFrequency=null}return i(e,[{key:"connect",value:function(e,t,r){this._server=e,this._username=t,this._password=r,this._connect()}},{key:"_connect",value:function(){}},{key:"disconnect",value:function(){this._server=null,this._username=null,this._password=null,this._disconnect()}},{key:"_disconnect",value:function(){}},{key:"on",value:function(){this._on.apply(this,arguments)}},{key:"_on",value:function(){}},{key:"off",value:function(){this._off.apply(this,arguments)}},{key:"_off",value:function(){}},{key:"getActiveSymbolCount",value:function(){return this._getActiveSymbolCount()}},{key:"_getActiveSymbolCount",value:function(){return null}},{key:"getPollingFrequency",value:function(){return this._pollingFrequency}},{key:"setPollingFrequency",value:function(e){this._pollingFrequency!==e&&(e&&e>0?this._pollingFrequency=e:this._pollingFrequency=null,this._onPollingFrequencyChanged(this._pollingFrequency))}},{key:"_onPollingFrequencyChanged",value:function(e){}},{key:"_handleProfileRequest",value:function(e){}},{key:"getMarketState",value:function(){return this._marketState}},{key:"getServer",value:function(){return this._server}},{key:"getPassword",value:function(){return this._password}},{key:"getUsername",value:function(){return this._username}},{key:"toString",value:function(){return"[ConnectionBase]"}}]),e}();return e}()},{"./../marketState/MarketState":9}],5:[function(e,t,r){"use strict";var n=e("./Connection");t.exports=function(){return n}()},{"./Connection":3}],6:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("@barchart/marketdata-utilities-js"),u=e("./../../../common/lang/array"),c=e("./../../../common/lang/object"),l=e("./../../ConnectionBase"),f=e("./../../../messageParser/parseMessage"),m=self||window;t.exports=function(){function e(e){function n(e,t){var r=Y.length-1;r>0&&Y[r].id===e?Y[r].symbols.push(t):Y.push({id:e,symbols:[t]})}function i(e,t){var r=void 0;switch(e){case"events":r=Q.events;break;case"marketDepth":r=Q.marketDepth[t.symbol];break;case"marketUpdate":r=Q.marketUpdate[t.symbol];break;case"timestamp":r=Q.timestamp}r&&r.forEach(function(e){return e(t)})}function a(){y([Q.marketUpdate,Q.cumulativeVolume]).forEach(function(e){n("MU_GO",e)}),y([Q.marketDepth]).forEach(function(e){n("MD_GO",e)})}function o(){y([Q.marketUpdate,Q.cumulativeVolume]).forEach(function(e){n("MU_STOP",e)}),y([Q.marketDepth]).forEach(function(e){n("MU_STOP",e)})}function l(){Y=[]}function v(e,t,n){q||z||(ee.username=t,ee.password=n,ee.server=e,m.WebSocket?(V=r.disconnected,q=new WebSocket("wss://"+ee.server+"/jerq"),q.binaryType="arraybuffer",H||(H=m.setInterval(function(){if(!$&&q){console.log(new Date+" bouncing, heartbeat timeout");try{q.readyState===WebSocket.OPEN&&q.send("LOGOUT\r\n"),q.close()}catch(e){console.warn("failed to send LOGOUT",e)}}$=null},h)),q.onclose=function(e){return console.warn(new Date+" connection closed. pending messages",K),q.onclose=null,q.onopen=null,q.onmessage=null,q=null,$=null,1===K.length&&0===K[0].indexOf("-")?(console.warn("not triggering reconnect: bad credentails"),void b()):(V=r.disconnected,i("events",{event:"disconnect"}),z?void console.warn("not triggering reconnect: user has logged out."):void setTimeout(function(){v(ee.server,ee.username,ee.password),l(),a()},p+Math.floor(Math.random()*h)))},q.onmessage=function(e){if($=1,e.data instanceof ArrayBuffer){var t=te.decode(e.data);t&&K.push(t)}else K.push(e.data)},q.onopen=function(e){console.log(new Date+" connection open.")}):console.warn("Websockets are not supported by this browser."))}function b(){console.warn("shutting down."),V=r.disconnected,null!==H&&m.clearInterval(H),null!==q&&(q.send("LOGOUT\r\n"),q.close()),H=null,$=null,Y=[],W=[],J=[]}function g(e){if(V===r.disconnected&&(V=r.connecting),V===r.connecting){var n=e.split("\n");n.forEach(function(e){"+++"==e&&(V=r.authenticating,W.splice(0,0,"LOGIN "+ee.username+":"+ee.password+" VERSION="+t+"\r\n"))})}else if(V===r.authenticating){var a=e.charAt(0);"+"===a?(V=r.authenticated,i("events",{event:"login success"})):"-"===a&&(b(),i("events",{event:"login fail"}))}V===r.authenticated&&J.push(e)}function y(e){var t=e.reduce(function(e,t){return e.concat(c.keys(t))},[]);return u.unique(t)}function w(e,t){var r=X[e]||[];return r.some(function(e){return P(e,t)})}function P(e,t){return t.some(function(t){return t.hasOwnProperty(e)&&0!==t[e].length})}function N(e,t){X.hasOwnProperty(t)||(X[t]=[]);var r=X[t];r.some(function(t){return t===e})||r.push(e)}function k(e){var t=X[e]||[],r=t.filter(function(e){return P(e,[Q.marketDepth,Q.marketUpdate,Q.cumulativeVolume])});return r}function T(){if(arguments.length<2)throw new Error("Wrong number of arguments. Must pass in an eventId and handler.");var e=arguments[0],t=arguments[1],r=void 0;r=arguments.length>2?arguments[2]:null;var i=function(e){var r=e||[];return r.filter(function(e){return e!==t})},a=function(e,t,a){var o=r,u=s.symbolParser.getProducerSymbol(o),c=a.concat(t),l=w(u,c),f=void 0;t[o]=i(t[o]||[]),f=w(u,c),l&&!f&&n(e,u),G[u]=k(u)};switch(e){case"events":Q.events=i(Q.events);break;case"marketDepth":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('marketDepth', handler, symbol)");a("MD_STOP",Q.marketDepth,[]);break;case"marketUpdate":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('marketUpdate', handler, symbol)");a("MU_STOP",Q.marketUpdate,[Q.cumulativeVolume]);break;case"cumulativeVolume":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: off('cumulativeVolume', handler, symbol)");a("MU_STOP",Q.cumulativeVolume,[Q.marketUpdate]),L.getCumulativeVolume(r,function(e){e.off("events",t)});break;case"timestamp":Q.timestamp=i(Q.timestamp)}}function I(){if(arguments.length<2)throw new Error("Bad number of arguments. Must pass in an eventId and handler.");var e=arguments[0],t=arguments[1],r=void 0;r=arguments.length>2?arguments[2]:null;var i=function(e){e=e||[];var r=!e.some(function(e){return e===t}),n=void 0;return r?(n=e.slice(0),n.push(t)):n=e,n},a=function(e,t,a,o){var u=r,c=s.symbolParser.getProducerSymbol(u);N(u,c);var l=w(c,o.concat(a));a[u]=i(a[u]),l?n(t,c):n(e,c),G[c]=k(c)};switch(e){case"events":Q.events=i(Q.events);break;case"marketDepth":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('marketDepth', handler, symbol)");a("MD_GO","MD_REFRESH",Q.marketDepth,[]),L.getBook(r)&&t({type:"INIT",symbol:r});break;case"marketUpdate":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('marketUpdate', handler, symbol)");a("MU_GO","MU_REFRESH",Q.marketUpdate,[Q.cumulativeVolume]),L.getQuote(r)&&t({type:"INIT",symbol:r});break;case"cumulativeVolume":if(arguments.length<3)throw new Error("Invalid arguments. Invoke as follows: on('cumulativeVolume', handler, symbol)");a("MU_GO","MU_REFRESH",Q.cumulativeVolume,[Q.marketUpdate]),L.getCumulativeVolume(r,function(e){e.on("events",t)});break;case"timestamp":Q.timestamp=i(Q.timestamp)}}function E(e){switch(L.processMessage(e),e.type){case"BOOK":i("marketDepth",e);break;case"TIMESTAMP":i("timestamp",L.getTimestamp());break;default:i("marketUpdate",e)}}function S(e){var t=void 0;try{if(t=f(e),t.type)if(t.symbol){var r=G[t.symbol]||[];Z.hasOwnProperty(t.symbol)&&(r=u.unique(r.concat(Z[t.symbol])),delete Z[t.symbol]),r.forEach(function(e){var r=void 0;e===t.symbol?r=t:(r=Object.assign({},t),r.symbol=e),E(r)})}else E(t);else console.log(e)}catch(n){console.error(n),console.log(t)}}function _(){if((V===r.authenticating||V===r.authenticated)&&q){var e=W.shift();if(V===r.authenticating&&e&&0===e.indexOf("GO"))console.log("pushing back GO command until fully authenticated."),W.push(e);else for(;e;)console.log(e),q.send(e),e=W.shift()}setTimeout(_,200)}function C(){for(var e=9,t=!1;!t;){var r=J.shift();if(r){var n=!1,i=1,a=-1,o=r.indexOf(d.etx),s=r.indexOf(d.lf);if(s>-1&&(o<0||s<o)?(a=s,i=2):o>-1&&(a=o),a>-1){var u=a+1;if(1==i&&(r.length<a+e+1?(J.length>0?J[0]=r+J[0]:(J.unshift(r),t=!0),n=!0):r.substr(a+1,1)==d.dc4&&(u+=e+1)),!n){var c=r.substring(0,u);2==i?c=c.trim():(a=c.indexOf(d.soh),a>0&&(c=c.substring(a))),c.length>0&&S(c),r=r.substring(u),r.length>0&&(J.length>0?J[0]=r+J[0]:J.unshift(r))}}else r.length>0&&(J.length>0?J[0]=r+J[0]:(J.unshift(r),t=!0))}else t=!0;0===J.length&&(t=!0)}setTimeout(C,125)}function x(){for(var e=K.shift();e;)g(e),e=K.shift();setTimeout(x,125)}function D(e){if(V===r.authenticated)for(;Y.length>0;){var t=Y.shift();if(t.callback)t.callback();else if(t.id){var n="",i="";switch(t.id){case"MD_GO":n="GO",i="Bb";break;case"MU_GO":n="GO",i="Ssc";break;case"MD_REFRESH":n="GO",i="b";break;case"MU_REFRESH":n="GO",i="sc";break;case"P_SNAPSHOT":n="GO",i="s";break;case"MD_STOP":n="STOP",i="Bb";break;case"MU_STOP":n="STOP",i="Ssc"}var a=u.unique(t.symbols),o=void 0;for(o="MD_GO"===t.id||"MD_STOP"===t.id?1:250;a.length>0;){var s=a.splice(0,o);W.push(n+" "+s.join(",")+"="+i)}}}e||R(!1)}function O(){if(V===r.authenticated&&0===W.length){Y=[];var e=function(e){for(var t=[];0!==e.length;)t.push(e.splice(0,250));return t},t=e(y([Q.marketUpdate,Q.cumulativeVolume]));t.forEach(function(e){W.push("GO "+e.join(",")+"=sc")});e(y([Q.marketDepth]));t.forEach(function(e){W.push("GO "+e.join(",")+"=b")});var n=e(u.unique(c.keys(Z)).filter(function(e){return!t.some(function(t){return t===e})}));n.forEach(function(e){W.push("GO "+e.join(",")+"=s")})}R(!0)}function A(e){B!==e&&(B=e)}function M(){return y([Q.marketDepth,Q.marketUpdate,Q.cumulativeVolume]).length}function R(e){var t=void 0,r=void 0;B?(e||(o(),D(!0)),t=O,r=B):(e&&a(),t=D,r=250),setTimeout(t,r)}function F(e,t,r){z=!1,v(e,t,r)}function U(){z=!0,ee.username=null,ee.password=null,ee.server=null,b()}function j(e){var t=s.symbolParser.getProducerSymbol(e),r=Z[t]||[];r.some(function(t){return t===e})||r.push(e),r.some(function(e){return e===t})||r.push(t),Z[t]=r,n("P_SNAPSHOT",t)}var L=e,V=r.disconnected,z=!1,B=null,q=null,H=null,$=null,G={},X={},Z={},Q={marketDepth:{},marketUpdate:{},cumulativeVolume:{},events:[],timestamp:[]},Y=[],W=[],J=[],K=[],ee={username:null,password:null,server:null},te=void 0;return te=m.TextDecoder?new TextDecoder:{decode:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},setTimeout(_,200),setTimeout(x,125),setTimeout(C,125),setTimeout(R,250),{connect:F,disconnect:U,off:T,on:I,getActiveSymbolCount:M,setPollingFrequency:A,handleProfileRequest:j}}var t=4,r={connecting:"CONNECTING",authenticating:"LOGGING_IN",authenticated:"LOGGED_IN",disconnected:"DISCONNECTED"},d={soh:"",etx:"",lf:"\n",dc4:""},p=5e3,h=1e4,v=function(t){function r(){n(this,r);var t=i(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t._internal=e(t.getMarketState()),t}return a(r,t),o(r,[{key:"_connect",value:function(){this._internal.connect(this.getServer(),this.getUsername(),this.getPassword())}},{key:"_disconnect",value:function(){this._internal.disconnect()}},{key:"_on",value:function(){this._internal.on.apply(this._internal,arguments)}},{key:"_off",value:function(){this._internal.off.apply(this._internal,arguments)}},{key:"_getActiveSymbolCount",value:function(){return this._internal.getActiveSymbolCount()}},{key:"_onPollingFrequencyChanged",value:function(e){return this._internal.setPollingFrequency(e)}},{key:"_handleProfileRequest",value:function(e){this._internal.handleProfileRequest(e)}},{key:"toString",value:function(){return"[Connection]"}}]),r}(l);return v}()},{"./../../../common/lang/array":1,"./../../../common/lang/object":2,"./../../../messageParser/parseMessage":14,"./../../ConnectionBase":4,"@barchart/marketdata-utilities-js":31}],7:[function(e,t,r){"use strict";var n=e("./connection/index"),i=e("./marketState/index"),a=e("./messageParser/index"),o=e("./util/index");t.exports=function(){return{Connection:n,MarketState:i,MessageParser:a,messageParser:a,Util:o,util:o,version:"3.1.18"}}()},{"./connection/index":5,"./marketState/index":12,"./messageParser/index":13,"./util/index":23}],8:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../common/lang/object");t.exports=function(){var e={update:"update",reset:"reset"},t=function(){function t(e,r){n(this,t),this.symbol=e,this._tickIncrement=r,this._handlers=[],this._priceLevels={},this._highPrice=null,this._lowPrice=null}return i(t,[{key:"on",value:function(e,t){var n=this;if("events"===e){var i=this._handlers.indexOf(t);if(i<0){var a=this._handlers.slice(0);a.push(t),this._handlers=a,this.toArray().forEach(function(e){r(n,t,e)})}}}},{key:"off",value:function(e,t){if("events"===e){var r=this._handlers.indexOf(t);if(!(r<0)){var n=this._handlers.slice(0);n.splice(r,1),this._handlers=n}}}},{key:"getTickIncrement",value:function(){return this._tickIncrement}},{key:"getVolume",value:function(e){var t=e.toString(),r=this._priceLevels[t];return r?r.volume:0}},{key:"incrementVolume",value:function(e,t){if(this._highPrice&&this._lowPrice){if(e>this._highPrice){for(var r=this._highPrice+this._tickIncrement;r<e;r+=this._tickIncrement)o(this,this._handlers,s(this._priceLevels,r.toString(),r));this._highPrice=e}else if(e<this._lowPrice){for(var n=this._lowPrice-this._tickIncrement;n>e;n-=this._tickIncrement)o(this,this._handlers,s(this._priceLevels,n.toString(),n));this._lowPrice=e}}else this._lowPrice=this._highPrice=e;var i=e.toString(),a=this._priceLevels[i];a||(a=s(this._priceLevels,i,e)),a.volume+=t,o(this,this._handlers,a)}},{key:"reset",value:function(){var t=this;this._priceLevels={},this._highPrice=null,this._lowPrice=null,this._handlers.forEach(function(r){r({container:t,event:e.reset})})}},{key:"toArray",value:function(){var e=this,t=a.keys(this._priceLevels).map(function(t){var r=e._priceLevels[t];return{price:r.price,volume:r.volume}});return t.sort(function(e,t){return e.price-t.price}),t}},{key:"dispose",value:function(){this._priceLevels={},this._highPrice=null,this._lowPrice=null,this._handlers=[]}}],[{key:"clone",value:function u(e,r){var u=new t(e,r.getTickIncrement());return r.toArray().forEach(function(e){u.incrementVolume(e.price,e.volume)}),u}}]),t}(),r=function(t,r,n){try{r({container:t,event:e.update,price:n.price,volume:n.volume})}catch(i){console.error("An error was thrown by a cumulative volume observer.",i)}},o=function(e,t,n){t.forEach(function(t){r(e,t,n)})},s=function(e,t,r){var n={price:r,volume:0};return e[t]=n,n};return t}()},{"./../common/lang/object":2}],9:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@barchart/marketdata-utilities-js"),o=e("./CumulativeVolume"),s=e("./Profile"),u=e("./Quote"),c=e("./../util/convertDayCodeToNumber");t.exports=function(){function e(e){var t={},r={},n={},i={},l=void 0,f=function(e){var r=t[e];if(!r){r={symbol:e,bids:[],asks:[]};var n=a.symbolParser.getProducerSymbol(e),i=t[n];i&&(r.bids=i.bids.slice(0),r.asks=i.asks.slice(0)),t[e]=r}return r},m=function(e){var t=n[e];if(!t){t={container:null,callbacks:[]};var r=a.symbolParser.getProducerSymbol(e),i=n[r];i&&i.container&&(t.container=o.clone(e,i.container)),n[e]=t}return t},d=function(e){var t=r[e];if(!t){var n=a.symbolParser.getProducerSymbol(e),i=r[n];t=i?u.clone(e,i):new u(e),r[e]=t}return t},p=function(e){var t=s.Profiles[e];if(!t){var r=a.symbolParser.getProducerSymbol(e),n=s.Profiles[r];n&&(t=new s(e,n.name,n.exchange,n.unitcode,n.pointValue,n.tickIncrement))}return t},h=function(e){var t=e.symbol;if("TIMESTAMP"===e.type)return void(l=e.timestamp);if("BOOK"===e.type){var r=f(t);return r.asks=e.asks,void(r.bids=e.bids)}if("REFRESH_CUMULATIVE_VOLUME"==e.type){var a=m(t),u=a.container;if(u)u.reset();else{a.container=u=new o(t,e.tickIncrement);var h=a.callbacks||[];h.forEach(function(e){e(u)}),a.callbacks=null}return void e.priceLevels.forEach(function(e){u.incrementVolume(e.price,e.volume)})}var v=p(t);if(!v&&"REFRESH_QUOTE"!==e.type)return console.warn("No profile found for "+t),void console.log(e);var b=d(t);if(!b.day&&e.day&&(b.day=e.day,b.dayNum=c(b.day)),b.day&&e.day){var g=c(e.day);if(g>b.dayNum||b.dayNum-g>5)b.day=e.day,b.dayNum=g,b.flag="p",b.bidPrice=0,b.bidSize=void 0,b.askPrice=void 0,b.askSize=void 0,b.settlementPrice?(b.previousPrice=b.settlementPrice,b.settlementPrice=void 0):b.lastPrice&&(b.previousPrice=b.lastPrice),b.lastPrice=void 0,b.tradePrice=void 0,b.tradeSize=void 0,b.numberOfTrades=void 0,b.openPrice=void 0,b.highPrice=void 0,b.lowPrice=void 0,b.volume=void 0;else if(b.dayNum>g)return;var y=n[t];switch(e.type){case"HIGH":b.highPrice=e.value;break;case"LOW":b.lowPrice=e.value;break;case"OPEN":b.flag=void 0,b.openPrice=e.value,b.highPrice=e.value,b.lowPrice=e.value,b.lastPrice=e.value,y&&y.container&&y.container.reset();break;case"OPEN_INTEREST":b.openInterest=e.value;break;case"REFRESH_DDF":switch(e.subrecord){case"1":case"2":case"3":b.message=e,null===e.openPrice?b.openPrice=void 0:e.openPrice&&(b.openPrice=e.openPrice),null===e.highPrice?b.highPrice=void 0:e.highPrice&&(b.highPrice=e.highPrice),null===e.lowPrice?b.lowPrice=void 0:e.lowPrice&&(b.lowPrice=e.lowPrice),null===e.lastPrice?b.lastPrice=void 0:e.lastPrice&&(b.lastPrice=e.lastPrice),null===e.bidPrice?b.bidPrice=void 0:e.bidPrice&&(b.bidPrice=e.bidPrice),null===e.askPrice?b.askPrice=void 0:e.askPrice&&(b.askPrice=e.askPrice),null===e.previousPrice?b.previousPrice=void 0:e.previousPrice&&(b.previousPrice=e.previousPrice),null===e.settlementPrice?(b.settlementPrice=void 0,"s"==b.flag&&(b.flag=void 0)):e.settlementPrice&&(b.settlementPrice=e.settlementPrice),null===e.volume?b.volume=void 0:e.volume&&(b.volume=e.volume),null===e.openInterest?b.openInterest=void 0:e.openInterest&&(b.openInterest=e.openInterest),"1"==e.subsrecord&&(b.lastUpdate=e.time)}break;case"REFRESH_QUOTE":v=new s(t,e.name,e.exchange,e.unitcode,e.pointValue,e.tickIncrement),b.message=e,b.flag=e.flag,b.mode=e.mode,b.lastUpdate=e.lastUpdate,b.bidPrice=e.bidPrice,b.bidSize=e.bidSize,b.askPrice=e.askPrice,b.askSize=e.askSize,b.lastPrice=e.lastPrice,b.tradeSize=e.tradeSize,b.numberOfTrades=e.numberOfTrades,b.previousPrice=e.previousPrice,b.settlementPrice=e.settlementPrice,b.openPrice=e.openPrice,b.highPrice=e.highPrice,b.lowPrice=e.lowPrice,b.volume=e.volume,b.openInterest=e.openInterest,e.tradeTime?b.time=e.tradeTime:e.timeStamp&&(b.time=e.timeStamp),i.hasOwnProperty(t)&&(i[t].forEach(function(e){e(v)}),delete i[t]);break;case"SETTLEMENT":b.lastPrice=e.value,b.settlement=e.value,"D"===e.element&&(b.flag="s");break;case"TOB":b.bidPrice=e.bidPrice,b.bidSize=e.bidSize,b.askPrice=e.askPrice,b.askSize=e.askSize,e.time&&(b.time=e.time);break;case"TRADE":for(b.flag=void 0,b.tradePrice=e.tradePrice,b.lastPrice=e.tradePrice,e.tradeSize&&(b.tradeSize=e.tradeSize,b.volume+=e.tradeSize),b.ticks.push({price:b.tradePrice,size:b.tradeSize});b.ticks.length>50;)b.ticks.shift();b.numberOfTrades||(b.numberOfTrades=0),b.numberOfTrades++,e.time&&(b.time=e.time),y&&y.container&&e.tradePrice&&e.tradeSize&&y.container.incrementVolume(b.tradePrice,b.tradeSize);break;case"TRADE_OUT_OF_SEQUENCE":e.tradeSize&&(b.volume+=e.tradeSize),y&&y.container&&e.tradePrice&&e.tradeSize&&y.container.incrementVolume(b.tradePrice,b.tradeSize);break;case"VOLUME":b.volume=e.value;break;case"VOLUME_YESTERDAY":break;case"VWAP":b.vwap1=e.value;break;default:console.error("Unhandled Market Message:"),console.log(e)}}},v=function(e){return t[e]},b=function(e,t){var r=m(e),n=void 0;return n=r.container?Promise.resolve(r.container):new Promise(function(e){r.callbacks.push(e)}),n.then(function(e){return"function"==typeof t&&t(e),e})},g=function(t,r){var n=p(t),a=void 0;return a=n?Promise.resolve(n):new Promise(function(r){i.hasOwnProperty(t)||(i[t]=[]),i[t].push(function(e){return r(e)}),e&&"function"==typeof e&&e(t)}),a.then(function(e){return"function"==typeof r&&r(e),e})},y=function(e){return r[e]},w=function(){return l};return{getBook:v,getCumulativeVolume:b,getProfile:g,getQuote:y,getTimestamp:w,processMessage:h}}var t=function(){function t(r){n(this,t),this._internal=e(r)}return i(t,[{key:"getBook",value:function(e){return this._internal.getBook(e)}},{key:"getCumulativeVolume",value:function(e,t){return this._internal.getCumulativeVolume(e,t)}},{key:"getProfile",value:function(e,t){return this._internal.getProfile(e,t)}},{key:"getQuote",value:function(e){return this._internal.getQuote(e)}},{key:"getTimestamp",value:function(){return this._internal.getTimestamp()}},{key:"processMessage",value:function(e){return this._internal.processMessage(e)}}],[{key:"CumulativeVolume",get:function(){return o}},{key:"Profile",get:function(){return s}},{key:"Quote",get:function(){return u}}]),t}();return t}()},{"./../util/convertDayCodeToNumber":20,"./CumulativeVolume":8,"./Profile":10,"./Quote":11,"@barchart/marketdata-utilities-js":31}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./../util/parseSymbolType"),o=e("./../util/priceFormatter");t.exports=function(){var e={},t=o("-",!0,",").format,r=function(){function r(t,i,o,s,u,c){n(this,r),this.symbol=t,this.name=i,this.exchange=o,this.unitCode=s,this.pointValue=u,this.tickIncrement=c;var l=a(this.symbol);l&&"future"===l.type&&(this.root=l.root,this.month=l.month,this.year=l.year),e[t]=this}return i(r,[{key:"formatPrice",value:function(e){return t(e,this.unitCode)}}],[{key:"setPriceFormatter",value:function(e,r,n){t=o(e,r,n).format}},{key:"PriceFormatter",value:function(e,t,n){r.setPriceFormatter(e,t,n)}},{key:"Profiles",get:function(){return e}}]),r}();return r}()},{"./../util/parseSymbolType":25,"./../util/priceFormatter":26}],11:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.exports=function(){var e=function(){function e(t){n(this,e),this.symbol=t||null,this.message=null,this.flag=null,this.mode=null,this.day=null,this.dayNum=0,this.session=null,this.lastUpdate=null,this.bidPrice=null,this.bidSize=null,this.askPrice=null,this.askSize=null,this.lastPrice=null,this.tradePrice=null,this.tradeSize=null,this.numberOfTrades=null,this.vwap1=null,this.vwap2=null,this.settlementPrice=null,this.openPrice=null,this.highPrice=null,this.lowPrice=null,this.volume=null,this.openInterest=null,this.previousPrice=null,this.time=null,this.ticks=[]}return i(e,null,[{key:"clone",value:function t(e,r){var t=Object.assign({},r);return t.symbol=e,t}}]),e}();return e}()},{}],12:[function(e,t,r){"use strict";var n=e("./MarketState");t.exports=function(){return n}()},{"./MarketState":9}],13:[function(e,t,r){"use strict";var n=e("./parseMessage"),i=e("./parseTimestamp"),a=e("./parseValue");t.exports=function(){return{parseMessage:n,parseTimestamp:i,parseValue:a,Parse:n,ParseTimestamp:i,ParseValue:a}}()},{"./parseMessage":14,"./parseTimestamp":15,"./parseValue":16}],14:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.messageParser}()},{"@barchart/marketdata-utilities-js":31}],15:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.timestampParser}()},{"@barchart/marketdata-utilities-js":31}],16:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.priceParser}()},{"@barchart/marketdata-utilities-js":31}],17:[function(e,t,r){"use strict";var n=e("xhr");t.exports=function(){return function(e){return Promise.resolve().then(function(){if("string"!=typeof e)throw new Error('The "symbol" argument must be a string.');if(0===e.length)throw new Error('The "symbol" argument must be at least one character.');return new Promise(function(t,r){try{var i={url:"https://instruments-prod.aws.barchart.com/instruments/"+encodeURIComponent(e),method:"GET"};n(i,function(n,i,a){if(n)r(n);else if(200!==i.statusCode)r("The server returned an HTTP "+i.statusCode+" response code.");else{var o=JSON.parse(a);o&&o.instrument&&o.instrument.symbol?t(o.instrument.symbol):r("The server was unable to resolve symbol "+e+".")}})}catch(a){r(a)}})})}}()},{xhr:48}],18:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.convert.baseCodeToUnitCode}()},{"@barchart/marketdata-utilities-js":31}],19:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.convert.dateToDayCode}()},{"@barchart/marketdata-utilities-js":31}],20:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.convert.dayCodeToNumber}()},{"@barchart/marketdata-utilities-js":31}],21:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.convert.unitCodeToBaseCode}()},{"@barchart/marketdata-utilities-js":31}],22:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.decimalFormatter}()},{"@barchart/marketdata-utilities-js":31}],23:[function(e,t,r){"use strict";var n=e("./convertBaseCodeToUnitCode"),i=e("./convertDateToDayCode"),a=e("./convertDayCodeToNumber"),o=e("./convertUnitCodeToBaseCode"),s=e("./decimalFormatter"),u=e("./monthCodes"),c=e("./parseSymbolType"),l=e("./priceFormatter"),f=e("./symbolResolver"),m=e("./timeFormatter");t.exports=function(){return{convertBaseCodeToUnitCode:n,convertUnitCodeToBaseCode:o,convertDateToDayCode:i,convertDayCodeToNumber:a,decimalFormatter:s,monthCodes:u,parseSymbolType:c,symbolResolver:f,BaseCode2UnitCode:n,DateToDayCode:i,DayCodeToNumber:a,MonthCodes:u,ParseSymbolType:c,PriceFormatter:l,TimeFormatter:m,UnitCode2BaseCode:o}}()},{"./convertBaseCodeToUnitCode":18,"./convertDateToDayCode":19,"./convertDayCodeToNumber":20,"./convertUnitCodeToBaseCode":21,"./decimalFormatter":22,"./monthCodes":24,"./parseSymbolType":25,"./priceFormatter":26,"./symbolResolver":17,"./timeFormatter":27}],24:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.monthCodes.getCodeToNameMap()}()},{"@barchart/marketdata-utilities-js":31}],25:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.symbolParser.parseInstrumentType}()},{"@barchart/marketdata-utilities-js":31}],26:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.priceFormatter}()},{"@barchart/marketdata-utilities-js":31}],27:[function(e,t,r){"use strict";var n=e("@barchart/marketdata-utilities-js");t.exports=function(){return n.timeFormatter}()},{"@barchart/marketdata-utilities-js":31}],28:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("xmldom");t.exports=function(){var e=function(){function e(){n(this,e),this._xmlDomParser=new a.DOMParser}return i(e,[{key:"parse",value:function(e){if("string"!=typeof e)throw new Error('The "textDocument" argument must be a string.');return console.log(this._xmlDomParser.parseFromString(e,"text/xml")),this._xmlDomParser.parseFromString(e,"text/xml")}},{key:"toString",value:function(){return"[XmlDomParser]"}}]),e}();return e}()},{xmldom:49}],29:[function(e,t,r){"use strict";t.exports=function(){return{unitCodeToBaseCode:function(e){switch(e){case"2":return-1;case"3":return-2;case"4":return-3;case"5":return-4;case"6":return-5;case"7":return-6;case"8":return 0;case"9":return 1;case"A":return 2;case"B":return 3;case"C":return 4;case"D":return 5;case"E":return 6;case"F":return 7;default:return 0}},baseCodeToUnitCode:function(e){switch(e){case-1:return"2";case-2:return"3";case-3:return"4";case-4:return"5";case-5:return"6";case-6:return"7";case 0:return"8";case 1:return"9";case 2:return"A";case 3:return"B";case 4:return"C";case 5:return"D";case 6:return"E";case 7:return"F";default:return 0}},dateToDayCode:function(e){var t=e.getDate();return t>=1&&t<=9?String.fromCharCode("1".charCodeAt(0)+t-1):10==t?"0":String.fromCharCode("A".charCodeAt(0)+t-11)},dayCodeToNumber:function(e){var t=parseInt(e,31);return t>9?t++:0===t&&(t=10),t}}}()},{}],30:[function(e,t,r){
"use strict";var n=e("lodash.isnan");t.exports=function(){return function(e,t,r,i){if(""===e||void 0===e||null===e||n(e))return"";var a=e<0&&i===!0;a&&(e=0-e);var o=e.toFixed(t);if(!r||e>-1e3&&e<1e3)a&&(o="("+o+")");else{for(var s=o.length,u=e<0,c=0===t,l=0,f=[],m=s-1;!(m<0);m--){3!==l||u&&0===m||(f.unshift(r),l=0);var d=o.charAt(m);f.unshift(d),c?l+=1:"."===d&&(c=!0)}a&&(f.unshift("("),f.push(")")),o=f.join("")}return o}}()},{"lodash.isnan":45}],31:[function(e,t,r){"use strict";var n=e("./convert"),i=e("./decimalFormatter"),a=e("./messageParser"),o=e("./monthCodes"),s=e("./priceFormatter"),u=e("./symbolFormatter"),c=e("./symbolParser"),l=e("./priceParser"),f=e("./stringToDecimalFormatter"),m=e("./timeFormatter"),d=e("./timestampParser");t.exports=function(){return{convert:n,decimalFormatter:i,monthCodes:o,messageParser:a,priceFormatter:s,symbolParser:c,priceParser:l,stringToDecimalFormatter:f,symbolFormatter:u,timeFormatter:m,timestampParser:d}}()},{"./convert":29,"./decimalFormatter":30,"./messageParser":32,"./monthCodes":33,"./priceFormatter":34,"./priceParser":35,"./stringToDecimalFormatter":36,"./symbolFormatter":37,"./symbolParser":38,"./timeFormatter":39,"./timestampParser":40}],32:[function(e,t,r){"use strict";var n=e("./priceParser"),i=e("./timestampParser"),a=e("./common/xml/XmlDomParser");t.exports=function(){return function(e){var t={message:e,type:null};switch(e.substr(0,1)){case"%":var r=void 0;try{var o=new a;r=o.parse(e.substring(1))}catch(s){r=void 0}if(r){var u=r.firstChild;switch(u.nodeName){case"BOOK":t.symbol=u.attributes.getNamedItem("symbol").value,t.unitcode=u.attributes.getNamedItem("basecode").value,t.askDepth=parseInt(u.attributes.getNamedItem("bidcount").value),t.bidDepth=parseInt(u.attributes.getNamedItem("bidcount").value),t.asks=[],t.bids=[];var c=void 0,l=void 0;if(u.attributes.getNamedItem("askprices")&&u.attributes.getNamedItem("asksizes")){c=u.attributes.getNamedItem("askprices").value.split(","),l=u.attributes.getNamedItem("asksizes").value.split(",");for(var f=0;f<c.length;f++)t.asks.push({price:n(c[f],t.unitcode),size:parseInt(l[f])})}if(u.attributes.getNamedItem("bidprices")&&u.attributes.getNamedItem("bidsizes")){c=u.attributes.getNamedItem("bidprices").value.split(","),l=u.attributes.getNamedItem("bidsizes").value.split(",");for(var m=0;m<c.length;m++)t.bids.push({price:n(c[m],t.unitcode),size:parseInt(l[m])})}t.type="BOOK";break;case"QUOTE":for(var d=0;d<u.attributes.length;d++){switch(u.attributes[d].name){case"symbol":t.symbol=u.attributes[d].value;break;case"name":t.name=u.attributes[d].value;break;case"exchange":t.exchange=u.attributes[d].value;break;case"basecode":t.unitcode=u.attributes[d].value;break;case"pointvalue":t.pointValue=parseFloat(u.attributes[d].value);break;case"tickincrement":t.tickIncrement=parseInt(u.attributes[d].value);break;case"flag":t.flag=u.attributes[d].value;break;case"lastupdate":var p=u.attributes[d].value;t.lastUpdate=new Date(parseInt(p.substr(0,4)),parseInt(p.substr(4,2))-1,parseInt(p.substr(6,2)),parseInt(p.substr(8,2)),parseInt(p.substr(10,2)),parseInt(p.substr(12,2)));break;case"bid":t.bidPrice=n(u.attributes[d].value,t.unitcode);break;case"bidsize":t.bidSize=parseInt(u.attributes[d].value);break;case"ask":t.askPrice=n(u.attributes[d].value,t.unitcode);break;case"asksize":t.askSize=parseInt(u.attributes[d].value);break;case"mode":t.mode=u.attributes[d].value}for(var h={},v=0;v<u.childNodes.length;v++)if("SESSION"==u.childNodes[v].nodeName){var b={},g=u.childNodes[v].attributes;if(g.getNamedItem("id")&&(b.id=g.getNamedItem("id").value),g.getNamedItem("day")&&(b.day=g.getNamedItem("day").value),g.getNamedItem("last")&&(b.lastPrice=n(g.getNamedItem("last").value,t.unitcode)),g.getNamedItem("previous")&&(b.previousPrice=n(g.getNamedItem("previous").value,t.unitcode)),g.getNamedItem("open")&&(b.openPrice=n(g.getNamedItem("open").value,t.unitcode)),g.getNamedItem("high")&&(b.highPrice=n(g.getNamedItem("high").value,t.unitcode)),g.getNamedItem("low")&&(b.lowPrice=n(g.getNamedItem("low").value,t.unitcode)),g.getNamedItem("tradesize")&&(b.tradeSize=parseInt(g.getNamedItem("tradesize").value)),g.getNamedItem("numtrades")&&(b.numberOfTrades=parseInt(g.getNamedItem("numtrades").value)),g.getNamedItem("settlement")&&(b.settlementPrice=n(g.getNamedItem("settlement").value,t.unitcode)),g.getNamedItem("volume")&&(b.volume=parseInt(g.getNamedItem("volume").value)),g.getNamedItem("openinterest")&&(b.openInterest=parseInt(g.getNamedItem("openinterest").value)),g.getNamedItem("timestamp")){var y=g.getNamedItem("timestamp").value;b.timeStamp=new Date(parseInt(y.substr(0,4)),parseInt(y.substr(4,2))-1,parseInt(y.substr(6,2)),parseInt(y.substr(8,2)),parseInt(y.substr(10,2)),parseInt(y.substr(12,2)))}if(g.getNamedItem("tradetime")){var w=g.getNamedItem("tradetime").value;b.tradeTime=new Date(parseInt(w.substr(0,4)),parseInt(w.substr(4,2))-1,parseInt(w.substr(6,2)),parseInt(w.substr(8,2)),parseInt(w.substr(10,2)),parseInt(w.substr(12,2)))}b.id&&(h[b.id]=b)}var P="undefined"==typeof h.combined.lastPrice,N=!P&&"undefined"!=typeof h.combined.settlementPrice,k=P?h.previous:h.combined;h.combined.previousPrice?t.previousPrice=h.combined.previousPrice:t.previousPrice=h.previous.previousPrice,k.lastPrice&&(t.lastPrice=k.lastPrice),k.openPrice&&(t.openPrice=k.openPrice),k.highPrice&&(t.highPrice=k.highPrice),k.lowPrice&&(t.lowPrice=k.lowPrice),k.tradeSize&&(t.tradeSize=k.tradeSize),k.numberOfTrades&&(t.numberOfTrades=k.numberOfTrades),k.settlementPrice&&(t.settlementPrice=k.settlementPrice),k.volume&&(t.volume=k.volume),k.openInterest&&(t.openInterest=k.openInterest),"combined"===k.id&&h.previous.openInterest&&(t.openInterest=h.previous.openInterest),k.timeStamp&&(t.timeStamp=k.timeStamp),k.tradeTime&&(t.tradeTime=k.tradeTime),h.combined.day&&(t.day=h.combined.day),P&&"undefined"==typeof t.flag&&(t.flag="p");var T=h.previous;if(t.previousPreviousPrice=T.previousPrice,t.previousSettlementPrice=T.settlementPrice,t.previousOpenPrice=T.openPrice,t.previousHighPrice=T.highPrice,t.previousLowPrice=T.lowPrice,t.previousTimeStamp=T.timeStamp,h.combined.day){var I="session_"+h.combined.day+"_T";if(h.hasOwnProperty(I)){var E=h[I],S=E.lastPrice;if(S){var _=E.tradeTime,C=E.tradeSize,x=void 0;if(_){var D=new Date(_.getFullYear(),_.getMonth(),_.getDate(),12,0,0,0);x=_.getTime()>D.getTime()}else x=!1;t.sessionT=x;var O=P||x;O&&(t.lastPriceT=S),(P||N)&&(t.session="T",O&&(_&&(t.tradeTime=_),C&&(t.tradeSize=C)),P&&(E.volume&&(t.volume=E.volume),E.previousPrice&&(t.previousPrice=E.previousPrice)))}}}}t.type="REFRESH_QUOTE";break;case"CV":t.type="REFRESH_CUMULATIVE_VOLUME",t.symbol=u.attributes.getNamedItem("symbol").value,t.unitCode=u.attributes.getNamedItem("basecode").value,t.tickIncrement=n(u.attributes.getNamedItem("tickincrement").value,t.unitCode);var A=u.attributes.getNamedItem("data");if(A){for(var M=A.value||"",R=M.split(":"),F=0;F<R.length;F++){var U=R[F],j=U.split(",");R[F]={price:n(j[0],t.unitCode),volume:parseInt(j[1])}}R.sort(function(e,t){return e.price-t.price}),t.priceLevels=R}else t.priceLevels=[];break;default:console.log(e)}}break;case"":switch(e.substr(1,1)){case"#":t.type="TIMESTAMP",t.timestamp=new Date(parseInt(e.substr(2,4)),parseInt(e.substr(6,2))-1,parseInt(e.substr(8,2)),parseInt(e.substr(10,2)),parseInt(e.substr(12,2)),parseInt(e.substr(14,2)));break;case"C":case"2":t.record="2";var L=e.indexOf(",",0);switch(t.symbol=e.substring(2,L),t.subrecord=e.substr(L+1,1),t.unitcode=e.substr(L+3,1),t.exchange=e.substr(L+4,1),t.delay=parseInt(e.substr(L+5,2)),t.subrecord){case"0":var V=e.indexOf(",",L+7);switch(t.value=n(e.substring(L+7,V),t.unitcode),t.element=e.substr(V+1,1),t.modifier=e.substr(V+2,1),t.element){case"A":t.type="OPEN";break;case"C":"1"==t.modifier&&(t.type="OPEN_INTEREST");break;case"D":case"d":"0"==t.modifier&&(t.type="SETTLEMENT");break;case"V":"0"==t.modifier&&(t.type="VWAP");break;case"0":"0"==t.modifier&&(t.tradePrice=t.value,t.type="TRADE");break;case"5":t.type="HIGH";break;case"6":t.type="LOW";break;case"7":"1"==t.modifier?t.type="VOLUME_YESTERDAY":"6"==t.modifier&&(t.type="VOLUME")}t.day=e.substr(V+3,1),t.session=e.substr(V+4,1),t.time=i(e.substr(e.indexOf("")+1,9));break;case"1":case"2":case"3":case"4":var z=e.substring(L+8).split(",");t.openPrice=n(z[0],t.unitcode),t.highPrice=n(z[1],t.unitcode),t.lowPrice=n(z[2],t.unitcode),t.lastPrice=n(z[3],t.unitcode),t.bidPrice=n(z[4],t.unitcode),t.askPrice=n(z[5],t.unitcode),t.previousPrice=n(z[7],t.unitcode),t.settlementPrice=n(z[10],t.unitcode),t.volume=z[13].length>0?parseInt(z[13]):void 0,t.openInterest=z[12].length>0?parseInt(z[12]):void 0,t.day=z[14].substr(0,1),t.session=z[14].substr(1,1),t.time=i(e.substr(e.indexOf("")+1,9)),t.type="REFRESH_DDF";break;case"7":var B=e.indexOf(",",L+7);t.tradePrice=n(e.substring(L+7,B),t.unitcode),L=B+1,B=e.indexOf(",",L),t.tradeSize=parseInt(e.substring(L,B)),L=B+1,t.day=e.substr(L,1),t.session=e.substr(L+1,1),t.time=i(e.substr(e.indexOf("")+1,9)),t.type="TRADE";break;case"8":var q=e.indexOf(",",L+7);t.bidPrice=n(e.substring(L+7,q),t.unitcode),L=q+1,q=e.indexOf(",",L),t.bidSize=parseInt(e.substring(L,q)),L=q+1,q=e.indexOf(",",L),t.askPrice=n(e.substring(L,q),t.unitcode),L=q+1,q=e.indexOf(",",L),t.askSize=parseInt(e.substring(L,q)),L=q+1,t.day=e.substr(L,1),t.session=e.substr(L+1,1),t.time=i(e.substr(e.indexOf("")+1,9)),t.type="TOB";break;case"Z":var H=e.indexOf(",",L+7);t.tradePrice=n(e.substring(L+7,H),t.unitcode),L=H+1,H=e.indexOf(",",L),t.tradeSize=parseInt(e.substring(L,H)),L=H+1,t.day=e.substr(L,1),t.session=e.substr(L+1,1),t.time=i(e.substr(e.indexOf("")+1,9)),t.type="TRADE_OUT_OF_SEQUENCE"}break;case"3":var $=e.indexOf(",",0);switch(t.symbol=e.substring(2,$),t.subrecord=e.substr($+1,1),t.subrecord){case"B":t.unitcode=e.substr($+3,1),t.exchange=e.substr($+4,1),t.bidDepth="A"==e.substr($+5,1)?10:parseInt(e.substr($+5,1)),t.askDepth="A"==e.substr($+6,1)?10:parseInt(e.substr($+6,1)),t.bids=[],t.asks=[];for(var G=e.substring($+8).split(","),X=0;X<G.length;X++){var Z=G[X].split(/[A-Z]/),Q=G[X].substr(Z[0].length,1);Q<="J"?t.asks.push({price:n(Z[0],t.unitcode),size:parseInt(Z[1])}):t.bids.push({price:n(Z[0],t.unitcode),size:parseInt(Z[1])})}t.type="BOOK"}break;default:t.type="UNKNOWN"}}return t}}()},{"./common/xml/XmlDomParser":28,"./priceParser":35,"./timestampParser":40}],33:[function(e,t,r){"use strict";t.exports=function(){var e={},t={},r=function(r,n,i){e[r]=n,t[r]=i};return r("F","January",1),r("G","February",2),r("H","March",3),r("J","April",4),r("K","May",5),r("M","June",6),r("N","July",7),r("Q","August",8),r("U","September",9),r("V","October",10),r("X","November",11),r("Z","December",12),r("Y","Cash",0),{getCodeToNameMap:function(){return e},getCodeToNumberMap:function(){return t}}}()},{}],34:[function(e,t,r){"use strict";var n=e("lodash.isnan"),i=e("./decimalFormatter");t.exports=function(){function e(e,t){return["000",Math.floor(e)].join("").substr(-1*t)}return function(t,r,a,o){function s(e){var r=Math.floor(e);return 0===r&&""===t?"":r}function u(e,t){return i(e,t,a,o)}var c=void 0;return c="."===t?function(e,t){switch(t){case"2":return u(e,3);case"3":return u(e,4);case"4":return u(e,5);case"5":return u(e,6);case"6":return u(e,7);case"7":return u(e,8);case"8":return u(e,0);case"9":return u(e,1);case"A":return u(e,2);case"B":return u(e,3);case"C":return u(e,4);case"D":return u(e,5);case"E":return u(e,6);default:return""===e||void 0===e||null===e||n(e)?"":e}}:function(i,a){if(""===i||void 0===i||null===i||n(i))return"";var c=i,l=Math.abs(i),f=i<0,m=void 0,d=void 0;switch(f?o===!0?(m="(",d=")"):(m="-",d=""):(m="",d=""),a){case"2":return[m,s(l),t,e(8*(l-Math.floor(l)),1),d].join("");case"3":return[m,s(l),t,e(16*(l-Math.floor(l)),2),d].join("");case"4":return[m,s(l),t,e(32*(l-Math.floor(l)),2),d].join("");case"5":return[m,s(l),t,e((l-Math.floor(l))*(r?320:64),r?3:2),d].join("");case"6":return[m,s(l),t,e((l-Math.floor(l))*(r?320:128),3),d].join("");case"7":return[m,s(l),t,e((l-Math.floor(l))*(r?320:256),3),d].join("");case"8":return u(c,0);case"9":return u(c,1);case"A":return u(c,2);case"B":return u(c,3);case"C":return u(c,4);case"D":return u(c,5);case"E":return u(c,6);default:return c}},{format:c}}}()},{"./decimalFormatter":30,"lodash.isnan":45}],35:[function(e,t,r){"use strict";t.exports=function(){function e(e){return t.hasOwnProperty(e)||(t[e]=new RegExp(e,"g")),t[e]}var t={};return function(t,r,n){if(!(t.length<1)){if("-"===t)return null;if(n&&(t=t.replace(e(n),"")),!(t.indexOf(".")<0))return parseFloat(t);var i="-"==t.substr(0,1)?-1:1;switch(i===-1&&(t=t.substr(1)),r){case"2":return i*((t.length>1?parseInt(t.substr(0,t.length-1)):0)+parseInt(t.substr(-1))/8);case"3":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/16);case"4":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/32);case"5":return i*((t.length>2?parseInt(t.substr(0,t.length-2)):0)+parseInt(t.substr(-2))/64);case"6":return i*((t.length>3?parseInt(t.substr(0,t.length-3)):0)+parseInt(t.substr(-3))/128);case"7":return i*((t.length>3?parseInt(t.substr(0,t.length-3)):0)+parseInt(t.substr(-3))/256);case"8":return i*parseInt(t);case"9":return i*(parseInt(t)/10);case"A":return i*(parseInt(t)/100);case"B":return i*(parseInt(t)/1e3);case"C":return i*(parseInt(t)/1e4);case"D":return i*(parseInt(t)/1e5);case"E":return i*(parseInt(t)/1e6);default:return i*parseInt(t)}}}}()},{}],36:[function(e,t,r){"use strict";var n=e("./convert");t.exports=function(){return function(e,t){var r=n.unitCodeToBaseCode(t);if(r===-4&&(7===e.length||6===e.length&&"1"!==e.charAt(0))&&(r-=1),r>=0){var i=1*e;return Math.round(i*Math.pow(10,r))/Math.pow(10,r)}var a=e.match(/-/),o=Math.pow(2,Math.abs(r)+2),s=String(o).length,u=e.length-s,c=u;"-"==e.substring(c-1,c)&&c--;var l=1*e.substring(0,c),f=1*e.substring(u,e.length);return r===-5&&(o=a?320:128),l+f/o}}()},{"./convert":29}],37:[function(e,t,r){"use strict";t.exports=function(){return{format:function(e){return null!==e&&"string"==typeof e?e.toUpperCase():e}}}()},{}],38:[function(e,t,r){"use strict";t.exports=function(){function e(e,t){var r=v.parseInstrumentType(e);return null!==r&&r.type===t}function t(e){var t=new Date,r=t.getFullYear(),n=parseInt(e);if(n<10){var i=n<r%10?1:0;n=10*Math.floor(r/10)+n+10*i}else if(n<100&&(n=100*Math.floor(r/100)+n,n<r)){var a=n+100;r-n>a-r&&(n=a)}return n}var r=/^(.*)\\.([A-Z]{1,4})$/i,n=/(.{1,3})([A-Z]{1})([0-9]{3}|[0-9]{1})?([0-9]{1})$/i,i=/^([A-Z][A-Z0-9\$\-!\.]{0,2})([A-Z]{1})([0-9]{4}|[0-9]{1,2})$/i,a=/^([A-Z][A-Z0-9\$\-!\.]{0,2})(\*{1})([0-9]{1})$/i,o=/^_S_/i,s=/^([A-Z][A-Z0-9\$\-!\.]?)([A-Z])([0-9]{1,4})([A-Z])$/i,u=/^([A-Z][A-Z0-9\$\-!\.]{0,2})([A-Z])([0-9]{1,4})\|(\-?[0-9]{1,5})(C|P)$/i,c=/^([A-Z][A-Z0-9\$\-!\.]{0,2})([A-Z])([0-9]{2})([0-9]{1,5})(C|P)$/i,l=/^\^([A-Z]{3})([A-Z]{3})$/i,f=/^\-(.*)$/i,m=/^\$(.*)$/i,d=/^(.*)\.BZ$/i,p=/(\.RT)$/,h={A:"F",B:"G",C:"H",D:"J",E:"K",I:"M",L:"N",O:"Q",P:"U",R:"V",S:"X",T:"Z"},v={parseInstrumentType:function(e){if("string"!=typeof e)return null;var n=e.match(r);if(null!==n&&(e=n[1]),o.test(e))return{symbol:e,type:"future_spread"};var d=e.match(i);if(null!==d)return{symbol:e,type:"future",root:d[1],dynamic:!1,month:d[2],year:t(d[3])};var p=e.match(a);if(null!==p)return{symbol:e,type:"future",root:p[1],dynamic:!0,dynamicCode:p[3]};var v=e.match(l);if(null!==v)return{symbol:e,type:"forex"};var b=e.match(m);if(null!==b)return{symbol:e,type:"index"};var g=e.match(f);if(null!==g)return{symbol:e,type:"sector"};var y=e.match(s);if(null!==y){var w=new Date,P=w.getFullYear(),N=void 0,k=void 0;return y[4]>="P"?(k=P+(y[4].charCodeAt(0)-"P".charCodeAt(0)),N="put"):(k=P+(y[4].charCodeAt(0)-"C".charCodeAt(0)),N="call"),{symbol:e,type:"future_option",root:y[1],month:y[2],year:k,strike:parseInt(y[3]),option_type:N}}var T=e.match(u),I=null!==T?T:e.match(c);if(null!==I){var E=I[2];return{symbol:e,type:"future_option",root:I[1],month:h.hasOwnProperty(E)?h[E]:E,year:t(I[3]),strike:parseInt(I[4]),option_type:"C"===I[5]?"call":"put"}}return null},getIsConcrete:function(e){return!v.getIsReference(e)},getIsReference:function(e){return a.test(e)},getIsFuture:function(t){return e(t,"future")},getIsFutureSpread:function(t){return e(t,"future_spread")},getIsFutureOption:function(t){return e(t,"future_option")},getIsForex:function(t){return e(t,"forex")},getIsSector:function(t){return e(t,"sector")},getIsIndex:function(t){return e(t,"index")},getIsBats:function(e){return d.test(e)},getProducerSymbol:function(e){if("string"==typeof e){var t=v.parseInstrumentType(e);if(null!==t&&"future_option"===t.type){var r=new Date,i=r.getFullYear(),a="call"===t.option_type?"C":"P",o=String.fromCharCode(a.charCodeAt(0)+(t.year-i));if(t.root.length<3)return t.root+t.month+t.strike+o;var s=t.year.toString().substr(-1);return t.root+t.month+s+"|"+t.strike+a}return e.replace(n,"$1$2$4")}return null},getFuturesOptionPipelineFormat:function(e){var t=v.parseInstrumentType(e);if(!t||"future_option"!==t.type)return null;var r="call"===t.option_type?"C":"P";return""+t.root+t.month+t.year.toString().substr(-1,1)+"|"+t.strike+r},displayUsingPercent:function(e){return p.test(e)}};return v}()},{}],39:[function(e,t,r){"use strict";t.exports=function(){function e(e){var t=e.getHours(),r=void 0;return 0===t?(t=12,r="AM"):12===t?(t=t,r="PM"):t>12?(t-=12,r="PM"):(t=t,r="AM"),i(t)+":"+i(e.getMinutes())+":"+i(e.getSeconds())+" "+r}function t(e){var t=e.getHours(),r=void 0;return 0===t?(t=12,r="A"):12===t?(t=t,r="P"):t>12?(t-=12,r="P"):(t=t,r="A"),i(t)+":"+i(e.getMinutes())+r}function r(e){return i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())}function n(e){return i(e.getHours())+":"+i(e.getMinutes())}function i(e){return("00"+e).substr(-2)}return function(a,o){var s=void 0;s=a?o?t:e:o?n:r;var u={format:function(e){var t=e.time;return t?!e.lastPrice||e.flag||e.sessionT?u.formatDate(t):u.formatTime(t,e.timezone):""},formatTime:function(e,t){var r=void 0;return e?(r=s(e),t&&(r=r+" "+t)):r="",r},formatDate:function(e){return e?i(e.getMonth()+1)+"/"+i(e.getDate())+"/"+i(e.getFullYear()):""}};return u}}()},{}],40:[function(e,t,r){"use strict";t.exports=function(){return function(e){if(9!==e.length)return null;var t=100*e.charCodeAt(0)+e.charCodeAt(1)-64,r=e.charCodeAt(2)-64-1,n=e.charCodeAt(3)-64,i=e.charCodeAt(4)-64,a=e.charCodeAt(5)-64,o=e.charCodeAt(6)-64,s=(255&e.charCodeAt(7))+((255&e.charCodeAt(8))<<8);return new Date(t,r,n,i,a,o,s)}}()},{}],41:[function(e,t,r){"use strict";var n=e("is-callable"),i=Object.prototype.toString,a=Object.prototype.hasOwnProperty,o=function(e,t,r){for(var n=0,i=e.length;n<i;n++)a.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))},s=function(e,t,r){for(var n=0,i=e.length;n<i;n++)null==r?t(e.charAt(n),n,e):t.call(r,e.charAt(n),n,e)},u=function(e,t,r){for(var n in e)a.call(e,n)&&(null==r?t(e[n],n,e):t.call(r,e[n],n,e))},c=function(e,t,r){if(!n(t))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=r),"[object Array]"===i.call(e)?o(e,t,a):"string"==typeof e?s(e,t,a):u(e,t,a)};t.exports=c},{"is-callable":43}],42:[function(e,t,r){(function(e){var r;r="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],43:[function(e,t,r){"use strict";var n=Function.prototype.toString,i=/^\s*class\b/,a=function(e){try{var t=n.call(e);return i.test(t)}catch(r){return!1}},o=function(e){try{return!a(e)&&(n.call(e),!0)}catch(t){return!1}},s=Object.prototype.toString,u="[object Function]",c="[object GeneratorFunction]",l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;t.exports=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(l)return o(e);if(a(e))return!1;var t=s.call(e);return t===u||t===c}},{}],44:[function(e,t,r){function n(e){var t=i.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var i=Object.prototype.toString},{}],45:[function(e,t,r){function n(e){return!!e&&"object"==typeof e}function i(e){return a(e)&&e!=+e}function a(e){return"number"==typeof e||n(e)&&u.call(e)==o}var o="[object Number]",s=Object.prototype,u=s.toString;t.exports=i},{}],46:[function(e,t,r){var n=e("trim"),i=e("for-each"),a=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return i(n(e).split("\n"),function(e){var r=e.indexOf(":"),i=n(e.slice(0,r)).toLowerCase(),o=n(e.slice(r+1));"undefined"==typeof t[i]?t[i]=o:a(t[i])?t[i].push(o):t[i]=[t[i],o]}),t}},{"for-each":41,trim:47}],47:[function(e,t,r){function n(e){return e.replace(/^\s*|\s*$/g,"")}r=t.exports=n,r.left=function(e){return e.replace(/^\s*/,"")},r.right=function(e){return e.replace(/\s*$/,"")}},{}],48:[function(e,t,r){"use strict";function n(e,t){for(var r=0;r<e.length;r++)t(e[r])}function i(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function a(e,t,r){var n=e;return f(t)?(r=t,"string"==typeof e&&(n={uri:e})):n=d(t,{uri:e}),n.callback=r,n}function o(e,t,r){return t=a(e,t,r),s(t)}function s(e){function t(){4===l.readyState&&a()}function r(){var e=void 0;if(e=l.response?l.response:l.responseText||u(l),w)try{e=JSON.parse(e)}catch(t){}return e}function n(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,c(e,P)}function a(){if(!d){var t;clearTimeout(p),t=e.useXDR&&void 0===l.status?200:1223===l.status?204:l.status;var n=P,i=null;return 0!==t?(n={body:r(),statusCode:t,method:v,headers:{},url:h,rawRequest:l},l.getAllResponseHeaders&&(n.headers=m(l.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),c(i,n,n.body)}}if("undefined"==typeof e.callback)throw new Error("callback argument missing");var s=!1,c=function(t,r,n){s||(s=!0,e.callback(t,r,n))},l=e.xhr||null;l||(l=e.cors||e.useXDR?new o.XDomainRequest:new o.XMLHttpRequest);var f,d,p,h=l.url=e.uri||e.url,v=l.method=e.method||"GET",b=e.body||e.data||null,g=l.headers=e.headers||{},y=!!e.sync,w=!1,P={body:void 0,headers:{},statusCode:0,method:v,url:h,rawRequest:l};if("json"in e&&e.json!==!1&&(w=!0,g.accept||g.Accept||(g.Accept="application/json"),"GET"!==v&&"HEAD"!==v&&(g["content-type"]||g["Content-Type"]||(g["Content-Type"]="application/json"),b=JSON.stringify(e.json===!0?b:e.json))),l.onreadystatechange=t,l.onload=a,l.onerror=n,l.onprogress=function(){},l.onabort=function(){d=!0},l.ontimeout=n,l.open(v,h,!y,e.username,e.password),y||(l.withCredentials=!!e.withCredentials),!y&&e.timeout>0&&(p=setTimeout(function(){if(!d){d=!0,l.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)}},e.timeout)),l.setRequestHeader)for(f in g)g.hasOwnProperty(f)&&l.setRequestHeader(f,g[f]);else if(e.headers&&!i(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(l.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(l),l.send(b),l}function u(e){if("document"===e.responseType)return e.responseXML;var t=204===e.status&&e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;return""!==e.responseType||t?null:e.responseXML}function c(){}var l=e("global/window"),f=e("is-function"),m=e("parse-headers"),d=e("xtend");t.exports=o,o.XMLHttpRequest=l.XMLHttpRequest||c,o.XDomainRequest="withCredentials"in new o.XMLHttpRequest?o.XMLHttpRequest:l.XDomainRequest,n(["get","put","post","patch","head","delete"],function(e){o["delete"===e?"del":e]=function(t,r,n){return r=a(t,r,n),r.method=e.toUpperCase(),s(r)}})},{"global/window":42,"is-function":44,"parse-headers":46,xtend:52}],49:[function(e,t,r){function n(e){this.options=e||{locator:{}}}function i(e,t,r){function n(t){var n=e[t];!n&&o&&(n=2==e.length?function(r){e(t,r)}:e),i[t]=n&&function(e){n("[xmldom "+t+"]\t"+e+s(r))}||function(){}}if(!e){if(t instanceof a)return t;e=t}var i={},o=e instanceof Function;return r=r||{},n("warning"),n("error"),n("fatalError"),i}function a(){this.cdata=!1}function o(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function s(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function u(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function c(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}n.prototype.parseFromString=function(e,t){var r=this.options,n=new l,o=r.domBuilder||new a,s=r.errorHandler,u=r.locator,c=r.xmlns||{},f={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return u&&o.setDocumentLocator(u),n.errorHandler=i(s,o,u),n.domBuilder=r.domBuilder||o,/\/x?html?$/.test(t)&&(f.nbsp=" ",f.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?n.parse(e,c,f):n.errorHandler.error("invalid doc source"),o.doc},a.prototype={startDocument:function(){this.doc=(new f).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var i=this.doc,a=i.createElementNS(e,r||t),s=n.length;c(this,a),this.currentElement=a,this.locator&&o(this.locator,a);for(var u=0;u<s;u++){var e=n.getURI(u),l=n.getValue(u),r=n.getQName(u),f=i.createAttributeNS(e,r);this.locator&&o(n.getLocator(u),f),f.value=f.nodeValue=l,a.setAttributeNode(f)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&o(this.locator,r),c(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=u.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else var n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&o(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=u.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&o(this.locator,n),c(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var i=n.createDocumentType(e,t,r);this.locator&&o(this.locator,i),c(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,s(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){a.prototype[e]=function(){return null}});var l=e("./sax").XMLReader,f=r.DOMImplementation=e("./dom").DOMImplementation;r.XMLSerializer=e("./dom").XMLSerializer,r.DOMParser=n},{"./dom":50,"./sax":51}],50:[function(e,t,r){function n(e,t){for(var r in e)t[r]=e[r]}function i(e,t){function r(){}var i=e.prototype;if(Object.create){var a=Object.create(t.prototype);i.__proto__=a}i instanceof t||(r.prototype=t.prototype,r=new r,n(i,r),e.prototype=i=r),i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}function a(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,ae[e]),this.message=ae[e],Error.captureStackTrace&&Error.captureStackTrace(this,a);return r.code=e,t&&(this.message=this.message+": "+t),r}function o(){}function s(e,t){this._node=e,this._refresh=t,u(this)}function u(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);B(e,"length",r.length),n(r,e),e._inc=t}}function c(){}function l(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function f(e,t,r,n){if(n?t[l(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var i=e.ownerDocument;i&&(n&&y(i,e,n),g(i,e,r))}}function m(e,t,r){var n=l(t,r);if(!(n>=0))throw a(se,new Error(e.tagName+"@"+r));for(var i=t.length-1;n<i;)t[n]=t[++n];if(t.length=i,e){var o=e.ownerDocument;o&&(y(o,e,r),r.ownerElement=null)}}function d(e){if(this._features={},e)for(var t in e)this._features=e[t]}function p(){}function h(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function v(e,t){if(t(e))return!0;if(e=e.firstChild)do if(v(e,t))return!0;while(e=e.nextSibling)}function b(){}function g(e,t,r){e&&e._inc++;var n=r.namespaceURI;"http://www.w3.org/2000/xmlns/"==n&&(t._nsMap[r.prefix?r.localName:""]=r.value)}function y(e,t,r,n){e&&e._inc++;var i=r.namespaceURI;"http://www.w3.org/2000/xmlns/"==i&&delete t._nsMap[r.prefix?r.localName:""]}function w(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var i=t.firstChild,a=0;i;)n[a++]=i,i=i.nextSibling;n.length=a}}}function P(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,w(e.ownerDocument,e),t}function N(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===re){var i=t.firstChild;if(null==i)return t;var a=t.lastChild}else i=a=t;var o=r?r.previousSibling:e.lastChild;i.previousSibling=o,a.nextSibling=r,o?o.nextSibling=i:e.firstChild=i,null==r?e.lastChild=a:r.previousSibling=a;do i.parentNode=e;while(i!==a&&(i=i.nextSibling));return w(e.ownerDocument||e,e),t.nodeType==re&&(t.firstChild=t.lastChild=null),t}function k(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t);var n=e.lastChild}var n=e.lastChild;return t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,w(e.ownerDocument,e,t),t}function T(){this._nsMap={}}function I(){}function E(){}function S(){}function _(){}function C(){}function x(){}function D(){}function O(){}function A(){}function M(){}function R(){}function F(){}function U(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,i=n.prefix,a=n.namespaceURI;if(a&&null==i){var i=n.lookupPrefix(a);if(null==i)var o=[{namespace:a,prefix:null}]}return L(this,r,e,t,o),r.join("")}function j(e,t,r){var n=e.prefix||"",i=e.namespaceURI;if(!n&&!i)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===i||"http://www.w3.org/2000/xmlns/"==i)return!1;for(var a=r.length;a--;){var o=r[a];if(o.prefix==n)return o.namespace!=i}return!0}function L(e,t,r,n,i){if(n){if(e=n(e),!e)return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case G:i||(i=[]);var a=(i.length,e.attributes),o=a.length,s=e.firstChild,u=e.tagName;r=H===e.namespaceURI||r,t.push("<",u);for(var c=0;c<o;c++){var l=a.item(c);"xmlns"==l.prefix?i.push({prefix:l.localName,namespace:l.value}):"xmlns"==l.nodeName&&i.push({prefix:"",namespace:l.value})}for(var c=0;c<o;c++){var l=a.item(c);if(j(l,r,i)){var f=l.prefix||"",m=l.namespaceURI,d=f?" xmlns:"+f:" xmlns";t.push(d,'="',m,'"'),i.push({prefix:f,namespace:m})}L(l,t,r,n,i)}if(j(e,r,i)){var f=e.prefix||"",m=e.namespaceURI,d=f?" xmlns:"+f:" xmlns";t.push(d,'="',m,'"'),i.push({prefix:f,namespace:m})}if(s||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(u)){if(t.push(">"),r&&/^script$/i.test(u))for(;s;)s.data?t.push(s.data):L(s,t,r,n,i),s=s.nextSibling;else for(;s;)L(s,t,r,n,i),s=s.nextSibling;t.push("</",u,">")}else t.push("/>");return;case ee:case re:for(var s=e.firstChild;s;)L(s,t,r,n,i),s=s.nextSibling;return;case X:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,h),'"');case Z:return t.push(e.data.replace(/[<&]/g,h));case Q:return t.push("<![CDATA[",e.data,"]]>");case K:return t.push("<!--",e.data,"-->");case te:var p=e.publicId,v=e.systemId;if(t.push("<!DOCTYPE ",e.name),p)t.push(' PUBLIC "',p),v&&"."!=v&&t.push('" "',v),t.push('">');else if(v&&"."!=v)t.push(' SYSTEM "',v,'">');else{
var b=e.internalSubset;b&&t.push(" [",b,"]"),t.push(">")}return;case J:return t.push("<?",e.target," ",e.data,"?>");case Y:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function V(e,t,r){var n;switch(t.nodeType){case G:n=t.cloneNode(!1),n.ownerDocument=e;case re:break;case X:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var i=t.firstChild;i;)n.appendChild(V(e,i,r)),i=i.nextSibling;return n}function z(e,t,r){var n=new t.constructor;for(var i in t){var a=t[i];"object"!=typeof a&&a!=n[i]&&(n[i]=a)}switch(t.childNodes&&(n.childNodes=new o),n.ownerDocument=e,n.nodeType){case G:var s=t.attributes,u=n.attributes=new c,l=s.length;u._ownerElement=n;for(var f=0;f<l;f++)n.setAttributeNode(z(e,s.item(f),!0));break;case X:r=!0}if(r)for(var m=t.firstChild;m;)n.appendChild(z(e,m,r)),m=m.nextSibling;return n}function B(e,t,r){e[t]=r}function q(e){switch(e.nodeType){case G:case re:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(q(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}var H="http://www.w3.org/1999/xhtml",$={},G=$.ELEMENT_NODE=1,X=$.ATTRIBUTE_NODE=2,Z=$.TEXT_NODE=3,Q=$.CDATA_SECTION_NODE=4,Y=$.ENTITY_REFERENCE_NODE=5,W=$.ENTITY_NODE=6,J=$.PROCESSING_INSTRUCTION_NODE=7,K=$.COMMENT_NODE=8,ee=$.DOCUMENT_NODE=9,te=$.DOCUMENT_TYPE_NODE=10,re=$.DOCUMENT_FRAGMENT_NODE=11,ne=$.NOTATION_NODE=12,ie={},ae={},oe=(ie.INDEX_SIZE_ERR=(ae[1]="Index size error",1),ie.DOMSTRING_SIZE_ERR=(ae[2]="DOMString size error",2),ie.HIERARCHY_REQUEST_ERR=(ae[3]="Hierarchy request error",3)),se=(ie.WRONG_DOCUMENT_ERR=(ae[4]="Wrong document",4),ie.INVALID_CHARACTER_ERR=(ae[5]="Invalid character",5),ie.NO_DATA_ALLOWED_ERR=(ae[6]="No data allowed",6),ie.NO_MODIFICATION_ALLOWED_ERR=(ae[7]="No modification allowed",7),ie.NOT_FOUND_ERR=(ae[8]="Not found",8)),ue=(ie.NOT_SUPPORTED_ERR=(ae[9]="Not supported",9),ie.INUSE_ATTRIBUTE_ERR=(ae[10]="Attribute in use",10));ie.INVALID_STATE_ERR=(ae[11]="Invalid state",11),ie.SYNTAX_ERR=(ae[12]="Syntax error",12),ie.INVALID_MODIFICATION_ERR=(ae[13]="Invalid modification",13),ie.NAMESPACE_ERR=(ae[14]="Invalid namespace",14),ie.INVALID_ACCESS_ERR=(ae[15]="Invalid access",15);a.prototype=Error.prototype,n(ie,a),o.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)L(this[n],r,e,t);return r.join("")}},s.prototype.item=function(e){return u(this),this[e]},i(s,o),c.prototype={length:0,item:o.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new a(ue);var r=this.getNamedItem(e.nodeName);return f(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new a(ue);return t=this.getNamedItemNS(e.namespaceURI,e.localName),f(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return m(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return m(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},d.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new b;if(n.implementation=this,n.childNodes=new o,n.doctype=r,r&&n.appendChild(r),t){var i=n.createElementNS(e,t);n.appendChild(i)}return n},createDocumentType:function(e,t,r){var n=new x;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},p.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return N(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return P(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return z(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==Z&&e.nodeType==Z?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==X?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==X?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return null==t}},n($,p),n($,p.prototype),b.prototype={nodeName:"#document",nodeType:ee,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==re){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==G&&(this.documentElement=e),N(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),P(this,e)},importNode:function(e,t){return V(this,e,t)},getElementById:function(e){var t=null;return v(this.documentElement,function(r){if(r.nodeType==G&&r.getAttribute("id")==e)return t=r,!0}),t},createElement:function(e){var t=new T;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new o;var r=t.attributes=new c;return r._ownerElement=t,t},createDocumentFragment:function(){var e=new M;return e.ownerDocument=this,e.childNodes=new o,e},createTextNode:function(e){var t=new S;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new _;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new C;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new R;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new I;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new A;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new T,n=t.split(":"),i=r.attributes=new c;return r.childNodes=new o,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,i._ownerElement=r,r},createAttributeNS:function(e,t){var r=new I,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},i(b,p),T.prototype={nodeType:G,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===re?this.insertBefore(e,null):k(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new s(this,function(t){var r=[];return v(t,function(n){n===t||n.nodeType!=G||"*"!==e&&n.tagName!=e||r.push(n)}),r})},getElementsByTagNameNS:function(e,t){return new s(this,function(r){var n=[];return v(r,function(i){i===r||i.nodeType!==G||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||n.push(i)}),n})}},b.prototype.getElementsByTagName=T.prototype.getElementsByTagName,b.prototype.getElementsByTagNameNS=T.prototype.getElementsByTagNameNS,i(T,p),I.prototype.nodeType=X,i(I,p),E.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(ae[oe])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){var n=this.data.substring(0,e),i=this.data.substring(e+t);r=n+r+i,this.nodeValue=this.data=r,this.length=r.length}},i(E,p),S.prototype={nodeName:"#text",nodeType:Z,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},i(S,E),_.prototype={nodeName:"#comment",nodeType:K},i(_,E),C.prototype={nodeName:"#cdata-section",nodeType:Q},i(C,E),x.prototype.nodeType=te,i(x,p),D.prototype.nodeType=ne,i(D,p),O.prototype.nodeType=W,i(O,p),A.prototype.nodeType=Y,i(A,p),M.prototype.nodeName="#document-fragment",M.prototype.nodeType=re,i(M,p),R.prototype.nodeType=J,i(R,p),F.prototype.serializeToString=function(e,t,r){return U.call(e,t,r)},p.prototype.toString=U;try{Object.defineProperty&&(Object.defineProperty(s.prototype,"length",{get:function(){return u(this),this.$$length}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return q(this)},set:function(e){switch(this.nodeType){case G:case re:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),B=function(e,t,r){e["$$"+t]=r})}catch(ce){}r.DOMImplementation=d,r.XMLSerializer=F},{}],51:[function(e,t,r){function n(){}function i(e,t,r,n,i){function l(e){if(e>65535){e-=65536;var t=55296+(e>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function p(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?l(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function h(t){if(t>k){var r=e.substring(k,t).replace(/&#?\w+;/g,p);w&&v(k),n.characters(r,0,t-k),k=t}}function v(t,r){for(;t>=g&&(r=y.exec(e));)b=r.index,g=b+r[0].length,w.lineNumber++;w.columnNumber=t-b+1}for(var b=0,g=0,y=/.*(?:\r\n?|\n)|.*$/g,w=n.locator,P=[{currentNSMap:t}],N={},k=0;;){try{var T=e.indexOf("<",k);if(T<0){if(!e.substr(k).match(/^\s*$/)){var I=n.doc,E=I.createTextNode(e.substr(k));I.appendChild(E),n.currentElement=E}return}switch(T>k&&h(T),e.charAt(T+1)){case"/":var S=e.indexOf(">",T+3),_=e.substring(T+2,S),C=P.pop();S<0?(_=e.substring(T+2).replace(/[\s<].*/,""),i.error("end tag name: "+_+" is not complete:"+C.tagName),S=T+1+_.length):_.match(/\s</)&&(_=_.replace(/[\s<].*/,""),i.error("end tag name: "+_+" maybe not complete"),S=T+1+_.length);var x=C.localNSMap,D=C.tagName==_,O=D||C.tagName&&C.tagName.toLowerCase()==_.toLowerCase();if(O){if(n.endElement(C.uri,C.localName,_),x)for(var A in x)n.endPrefixMapping(A);D||i.fatalError("end tag name: "+_+" is not match the current start tagName:"+C.tagName)}else P.push(C);S++;break;case"?":w&&v(T),S=m(e,T,n);break;case"!":w&&v(T),S=f(e,T,n,i);break;default:w&&v(T);var M=new d,R=P[P.length-1].currentNSMap,S=o(e,T,M,R,p,i),F=M.length;if(!M.closed&&c(e,S,M.tagName,N)&&(M.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),w&&F){for(var U=a(w,{}),j=0;j<F;j++){var L=M[j];v(L.offset),L.locator=a(w,{})}n.locator=U,s(M,n,R)&&P.push(M),n.locator=w}else s(M,n,R)&&P.push(M);"http://www.w3.org/1999/xhtml"!==M.uri||M.closed?S++:S=u(e,S,M.tagName,p,n)}}catch(V){i.error("element parse error: "+V),S=-1}S>k?k=S:h(Math.max(T,k)+1)}}function a(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function o(e,t,r,n,i,a){for(var o,s,u=++t,c=y;;){var l=e.charAt(u);switch(l){case"=":if(c===w)o=e.slice(t,u),c=N;else{if(c!==P)throw new Error("attribute equal must after attrName");c=N}break;case"'":case'"':if(c===N||c===w){if(c===w&&(a.warning('attribute value must after "="'),o=e.slice(t,u)),t=u+1,u=e.indexOf(l,t),!(u>0))throw new Error("attribute value no end '"+l+"' match");s=e.slice(t,u).replace(/&#?\w+;/g,i),r.add(o,s,t-1),c=T}else{if(c!=k)throw new Error('attribute value must after "="');s=e.slice(t,u).replace(/&#?\w+;/g,i),r.add(o,s,t),a.warning('attribute "'+o+'" missed start quot('+l+")!!"),t=u+1,c=T}break;case"/":switch(c){case y:r.setTagName(e.slice(t,u));case T:case I:case E:c=E,r.closed=!0;case k:case w:case P:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),c==y&&r.setTagName(e.slice(t,u)),u;case">":switch(c){case y:r.setTagName(e.slice(t,u));case T:case I:case E:break;case k:case w:s=e.slice(t,u),"/"===s.slice(-1)&&(r.closed=!0,s=s.slice(0,-1));case P:c===P&&(s=o),c==k?(a.warning('attribute "'+s+'" missed quot(")!!'),r.add(o,s.replace(/&#?\w+;/g,i),t)):("http://www.w3.org/1999/xhtml"===n[""]&&s.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+s+'" missed value!! "'+s+'" instead!!'),r.add(s,s,t));break;case N:throw new Error("attribute value missed!!")}return u;case"":l=" ";default:if(l<=" ")switch(c){case y:r.setTagName(e.slice(t,u)),c=I;break;case w:o=e.slice(t,u),c=P;break;case k:var s=e.slice(t,u).replace(/&#?\w+;/g,i);a.warning('attribute "'+s+'" missed quot(")!!'),r.add(o,s,t);case T:c=I}else switch(c){case P:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&o.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),r.add(o,o,t),t=u,c=w;break;case T:a.warning('attribute space is required"'+o+'"!!');case I:c=w,t=u;break;case N:c=k,t=u;break;case E:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function s(e,t,r){for(var n=e.tagName,i=null,a=e.length;a--;){var o=e[a],s=o.qName,u=o.value,c=s.indexOf(":");if(c>0)var f=o.prefix=s.slice(0,c),m=s.slice(c+1),d="xmlns"===f&&m;else m=s,f=null,d="xmlns"===s&&"";o.localName=m,d!==!1&&(null==i&&(i={},l(r,r={})),r[d]=i[d]=u,o.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(d,u))}for(var a=e.length;a--;){o=e[a];var f=o.prefix;f&&("xml"===f&&(o.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==f&&(o.uri=r[f||""]))}var c=n.indexOf(":");c>0?(f=e.prefix=n.slice(0,c),m=e.localName=n.slice(c+1)):(f=null,m=e.localName=n);var p=e.uri=r[f||""];if(t.startElement(p,m,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=i,!0;if(t.endElement(p,m,n),i)for(f in i)t.endPrefixMapping(f)}function u(e,t,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var a=e.indexOf("</"+r+">",t),o=e.substring(t+1,a);if(/[&<]/.test(o))return/^script$/i.test(r)?(i.characters(o,0,o.length),a):(o=o.replace(/&#?\w+;/g,n),i.characters(o,0,o.length),a)}return t+1}function c(e,t,r,n){var i=n[r];return null==i&&(i=e.lastIndexOf("</"+r+">"),i<t&&(i=e.lastIndexOf("</"+r)),n[r]=i),i<t}function l(e,t){for(var r in e)t[r]=e[r]}function f(e,t,r,n){var i=e.charAt(t+2);switch(i){case"-":if("-"===e.charAt(t+3)){var a=e.indexOf("-->",t+4);return a>t?(r.comment(e,t+4,a-t-4),a+3):(n.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var a=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,a-t-9),r.endCDATA(),a+3}var o=h(e,t),s=o.length;if(s>1&&/!doctype/i.test(o[0][0])){var u=o[1][0],c=s>3&&/^public$/i.test(o[2][0])&&o[3][0],l=s>4&&o[4][0],f=o[s-1];return r.startDTD(u,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),f.index+f[0].length}}return-1}function m(e,t,r){var n=e.indexOf("?>",t);if(n){var i=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return r.processingInstruction(i[1],i[2]),n+2}return-1}return-1}function d(e){}function p(e,t){return e.__proto__=t,e}function h(e,t){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);r=i.exec(e);)if(n.push(r),r[1])return n}var v=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,b=new RegExp("[\\-\\.0-9"+v.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),g=new RegExp("^"+v.source+b.source+"*(?::"+v.source+b.source+"*)?$"),y=0,w=1,P=2,N=3,k=4,T=5,I=6,E=7;n.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),l(t,t={}),i(e,t,r,n,this.errorHandler),n.endDocument()}},d.prototype={setTagName:function(e){if(!g.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!g.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},p({},p.prototype)instanceof p||(p=function(e,t){function r(){}r.prototype=t,r=new r;for(t in e)r[t]=e[t];return r}),r.XMLReader=n},{}],52:[function(e,t,r){function n(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)i.call(r,n)&&(e[n]=r[n])}return e}t.exports=n;var i=Object.prototype.hasOwnProperty},{}]},{},[7])(7)});